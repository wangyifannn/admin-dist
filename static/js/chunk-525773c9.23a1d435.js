(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-525773c9"],{"054f":function(e,t,a){},"565b":function(e,t,a){},a34f:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"guidance-container"},[a("el-card",{staticStyle:{"margin-bottom":"30px"}},[a("div",{staticClass:"express-container"},[a("div",{staticClass:"express-item",on:{click:function(t){return e.$router.push({name:"RecipesAdd"})}}},[e._v("\n        新建定制食谱任务\n      ")])]),a("div",{staticClass:"search-container"},[a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("宝宝乳名")]),a("div",[a("el-input",{attrs:{placeholder:"请输入宝宝乳名",size:"mini"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("用户")]),a("div",[a("el-input",{attrs:{placeholder:"请输入用户昵称或备注名",size:"mini"},model:{value:e.searchForm.nickname,callback:function(t){e.$set(e.searchForm,"nickname",t)},expression:"searchForm.nickname"}})],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("用户ID")]),a("div",[a("el-input",{attrs:{placeholder:"请输入用户ID",size:"mini"},model:{value:e.searchForm.uid,callback:function(t){e.$set(e.searchForm,"uid",t)},expression:"searchForm.uid"}})],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("完成状态")]),a("div",[a("el-select",{attrs:{size:"mini",disabled:e.statusDisabled,placeholder:"请选择"},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)])])],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("创建人")]),a("div",[a("el-select",{attrs:{size:"mini"},model:{value:e.searchForm.createrId,callback:function(t){e.$set(e.searchForm,"createrId",t)},expression:"searchForm.createrId"}},e._l(e.creaters,(function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})})),1)],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("发送人")]),a("div",[a("el-select",{attrs:{size:"mini"},model:{value:e.searchForm.senderId,callback:function(t){e.$set(e.searchForm,"senderId",t)},expression:"searchForm.senderId"}},e._l(e.senders,(function(e){return a("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})})),1)],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("宝宝ID")]),a("div",[a("el-input",{attrs:{placeholder:"请输入宝宝ID",size:"mini"},model:{value:e.searchForm.babyId,callback:function(t){e.$set(e.searchForm,"babyId",t)},expression:"searchForm.babyId"}})],1)])])],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-time search-date-picker"},[a("div",[e._v("\n              任务执行时间\n            ")]),a("div",[a("el-date-picker",{attrs:{size:"mini",type:"datetimerange","range-separator":"-","start-placeholder":"请选择时间范围起始","end-placeholder":"请选择时间范围结束"},model:{value:e.searchTime,callback:function(t){e.searchTime=t},expression:"searchTime"}})],1)])]),a("el-col",{attrs:{span:16}},[a("div",{staticClass:"recipes-button"},[a("div",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.search}},[e._v("搜索")])],1),a("div",[a("el-button",{attrs:{size:"mini"},on:{click:e.reset}},[e._v("重置")])],1)])])],1)],1)]),a("el-card",[a("el-tabs",{staticClass:"tab-container",staticStyle:{"padding-right":"20px"},on:{"tab-click":e.handleTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"1"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("div",[e.recipesTaskCount.todayListNum>0?a("el-badge",{staticClass:"item",attrs:{value:e.recipesTaskCount.todayListNum}},[e._v("\n              今日待发送\n            ")]):a("span",[e._v("今日待发送")])],1)])]),a("el-tab-pane",{attrs:{name:"2"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("div",[e.recipesTaskCount.allListNum>0?a("el-badge",{staticClass:"item",attrs:{value:e.recipesTaskCount.allListNum}},[e._v("\n              全部待发送\n            ")]):a("span",[e._v("全部待发送")])],1)])]),a("el-tab-pane",{attrs:{name:"3"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("div",[e.recipesTaskCount.needToRelayNum>0?a("el-badge",{staticClass:"item",attrs:{value:e.recipesTaskCount.needToRelayNum}},[e._v("\n              留言待回复\n            ")]):a("span",[e._v("留言待回复")])],1)])]),a("el-tab-pane",{attrs:{name:"0"}},[a("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n          全部任务\n        ")])])],1),a("div",{staticClass:"table-title"},[e._v("\n      定制食谱任务列表\n    ")]),a("task-list",{ref:"taskList",attrs:{"search-form":e.searchForm},on:{closeTask:e.search}})],1)],1)},i=[],r=(a("386d"),a("6762"),a("2fdb"),a("db72")),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{width:"50px",prop:"index",label:"序号"}}),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"title",label:"食谱名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{attrs:{title:t.row.title}},[e._v("\n          "+e._s(t.row.title)+"\n        ")])]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",width:"200px",label:"宝宝"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{"text-align":"center"}},[a("div",[e._v("\n            "+e._s(t.row.family_member&&t.row.family_member.name)+"\n          ")]),a("div",[e._v("\n            "+e._s(t.row.family_member&&t.row.family_member.babyId||t.row.family_member.id)+"\n          ")])])]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",width:"200px",label:"用户"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",{staticStyle:{display:"inline-block"}},[a("el-avatar",{staticStyle:{"vertical-align":"middle"},attrs:{size:"small",src:t.row&&t.row.user.avatar}}),e._v("\n            "+e._s(t.row.user.remark_name?t.row.user.remark_name:t.row.user.nickname)+"\n            "),t.row.is_replace?a("svg-icon",{attrs:{"icon-class":"replace"}}):e._e()],1),a("div",[e._v("\n            "+e._s(t.row.user._id)+"\n          ")])])]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"creater",label:"创建人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.creater.name)+"\n      ")]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"sender",width:"80px",label:"发送人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.sender?t.row.sender.name:"未知")+"\n      ")]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"createTime",width:"220px",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatTime")(new Date(t.row.createTime)))+"\n      ")]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"任务执行日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatTime")(new Date(t.row.executeTime),"y-m-d"))+"\n      ")]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",width:"220px",label:"发送时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[5===t.row.status?a("span",[e._v("\n            已关闭\n          ")]):e.taskHasNotSend(t.row.status)?a("span",[e._v("\n            待发送\n          ")]):a("span",[e._v("\n            "+e._s(e._f("formatTime")(new Date(t.row.sendTime)))+"\n          ")])])]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",label:"完成状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("recipesTaskStatus")(t.row.status))+"\n      ")]}}])}),a("el-table-column",{attrs:{align:"center","header-align":"center",prop:"address",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"flex-row-center"},[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClick(t.row)}}},[e._v("\n            "+e._s(e.switchHandleText(t.row.status))+"\n          ")]),e.canBeCanceled(t.row.status)?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClose(t.row)}}},[e._v("关闭任务")]):e._e()],1)]}}])})],1),a("div",{staticStyle:{"margin-top":"10px","text-align":"center"}},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("task-close-dialog",{attrs:{closeDialogVisible:e.closeDialogVisible},on:{closeTask:e.closeTask,closeDialog:function(t){e.closeDialogVisible=!1}}})],1)},l=[],c=(a("c5f6"),a("1e42")),o=a("2f62"),u=a("ed08"),d=a("7afd"),m={name:"TaskList",props:{taskType:{type:Number,default:1},searchForm:{type:Object,default:function(){}}},components:{TaskCloseDialog:d["a"]},data:function(){return{closeDialogVisible:!1,closeTaskId:"",loading:!1,currentPage:1,pageSize:10,total:0,tableData:[]}},computed:Object(r["a"])({},Object(o["c"])(["recipesBabies","selectBaby"])),mounted:function(){this.getAllTaskList({taskStatus:1})},methods:Object(r["a"])({},Object(o["d"])({setSelectBaby:"health/SET_SELECTBABY",setTaskCount:"recipes/SET_TASKCOUNT",setCreaters:"recipes/SET_CREATERS",setSenders:"recipes/SET_SENDERS"}),{},Object(o["b"])({getBabyList:"recipes/getBabyList"}),{taskHasNotSend:function(e){return 0===e||2===e},handleClose:function(e){this.closeDialogVisible=!0,this.closeTaskId=e._id},closeTask:function(e){var t=this,a={reason:e.closeReasonType,reason_message:e.closeReason};Object(c["b"])(this.closeTaskId,a).then((function(e){2e4===e.code&&(t.closeDialogVisible=!1,t.$message.success("关闭任务成功"),t.$emit("closeTask"))}))},canBeCanceled:function(e){return 0===e||2===e},switchHandleText:function(e){switch(e){case 0:return"去发送";case 1:return"去回复";case 2:return"去发送";case 3:return"查看详情";case 4:return"查看详情";case 5:return"查看详情"}},getAllTaskList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0;var a=Object(r["a"])({},t,{currentPage:this.currentPage,pageSize:this.pageSize});Object(c["h"])(a).then((function(t){if(2e4===t.code){e.loading=!1;var a=t.data;e.tableData=a.list,e.total=a.count;var s={todayListNum:a.todayListNum,allListNum:a.allListNum,needToRelayNum:a.needToRelayNum};e.setTaskCount(s),e.setCreaters(a.creater),e.setSenders(a.sender)}}))},handleSizeChange:function(e){this.pageSize=e,this.getAllTaskList(this.searchForm)},handleCurrentChange:function(e){this.currentPage=e,this.getAllTaskList(this.searchForm)},handleClick:function(e){switch(Object(u["j"])("currentTask",JSON.stringify(e)),e.status){case 0:this.$router.push({path:"recipes/send",query:{id:e.family_member._id}});break;case 1:this.$router.push({path:"recipes/comment",query:{id:e.family_member._id}});break;case 2:this.$router.push({path:"recipes/send",query:{id:e.family_member._id}});break;case 3:this.$router.push({path:"recipes/detail",query:{id:e.family_member._id}});break;case 4:this.$router.push({path:"recipes/detail",query:{id:e.family_member._id}});break;case 5:this.$router.push({path:"recipes/close",query:{babyId:e.family_member._id,taskId:e._id}})}}})},h=m,p=a("2877"),b=Object(p["a"])(h,n,l,!1,null,null,null),v=b.exports,f={name:"Guidance",components:{TaskList:v},data:function(){return{statusDisabled:!0,searchForm:{name:"",nickname:"",uid:"",status:"",beginTime:"",endTime:"",createrId:"",senderId:"",taskStatus:"",babyId:""},searchTime:null,activeName:"1",statusOptions:[{value:"",label:"今日待发送"}]}},computed:Object(r["a"])({},Object(o["c"])(["recipesTaskCount","creaters","senders"])),methods:{resetSearchForm:function(){this.searchForm={name:"",nickname:"",uid:"",status:"",beginTime:"",endTime:"",createrId:"",senderId:""}},handleTab:function(){if(this.$refs.taskList.pageSize=10,this.$refs.taskList.currentPage=1,this.resetSearchForm(),this.searchForm.taskStatus=this.activeName,this.$refs.taskList.getAllTaskList(this.searchForm),"0"!==this.activeName)return this.statusDisabled=!0,void this.filterSatatusOptions(this.activeName);this.statusDisabled=!1,this.resetStatus()},resetStatus:function(){this.searchForm.status=null,this.statusOptions=[{value:0,label:"待填写"},{value:1,label:"留言待回复"},{value:2,label:"已保存"},{value:3,label:"已发送"},{value:4,label:"已完成"},{value:5,label:"已关闭"}]},filterSatatusOptions:function(e){switch(e){case"1":this.searchForm.status="",this.statusOptions=[{value:"",label:"今日待发送"}];break;case"2":this.searchForm.status="",this.statusOptions=[{value:"",label:"全部待发送"}];break;case"3":this.searchForm.status="",this.statusOptions=[{value:"",label:"留言待回复"}]}},search:function(){this.$refs.taskList.pageSize=10,this.$refs.taskList.currentPage=1,this.searchForm.beginTime=this.searchTime?this.searchTime[0]:"",this.searchForm.endTime=this.searchTime?this.searchTime[1]:"",this.$refs.taskList.getAllTaskList(this.searchForm)},reset:function(){this.resetSearchForm(),this.searchForm.taskStatus=this.activeName,this.searchTime=null,this.$refs.taskList.pageSize=10,this.$refs.taskList.currentPage=1,this.$refs.taskList.getAllTaskList(this.searchForm)},needKeepAlive:function(e){var t=["recipes/send","recipes/detail","recipes/comment","recipes/add","recipes/close"];return t.some((function(t){return e.includes(t)}))},refreshPage:function(){this.statusDisabled=!0,this.activeName="1",this.statusOptions=[{value:"",label:"今日待发送"}],this.reset()}},beforeRouteEnter:function(e,t,a){a((function(e){e.needKeepAlive(t.path)?e.search():e.refreshPage()}))}},k=f,_=(a("c825"),a("c05f"),Object(p["a"])(k,s,i,!1,null,"41b42b3c",null));t["default"]=_.exports},c05f:function(e,t,a){"use strict";var s=a("054f"),i=a.n(s);i.a},c825:function(e,t,a){"use strict";var s=a("565b"),i=a.n(s);i.a}}]);
//# sourceMappingURL=chunk-525773c9.23a1d435.js.map