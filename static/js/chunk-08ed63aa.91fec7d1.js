(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08ed63aa"],{"350a":function(e,t,n){"use strict";var i=n("c2d7"),r=n.n(i);r.a},"3be2":function(e,t,n){"use strict";var i=n("9b53"),r=n.n(i);r.a},"612f":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{multiple:"",disabled:e.uploadLoading,action:"",limit:3,"on-error":e.handleFileError,"on-success":e.handleFileSuccess,"before-upload":e.beforeFileUpload,"http-request":e.uploadFileFunc,"file-list":e.fileList,"on-change":e.handleChange,"on-exceed":e.videoExceed,"on-preview":e.previewVideo,"before-remove":e.videoRemove}},[n("el-button",{attrs:{slot:"trigger",size:"small",type:"primary",disabled:e.fileList.length>=3,loading:e.uploadLoading},slot:"trigger"},[e._v("\n      上传视频\n    ")]),n("div",{staticClass:"el-upload__tip",staticStyle:{color:"#F8747F"},attrs:{slot:"tip"},slot:"tip"},[e._v("\n      温馨提示：视频上传后会在文章末尾依次展示，支持最多3个视频\n    ")])],1),n("monitor",{ref:"monitor",attrs:{"monitor-info":e.monitorInfo}})],1)},r=[],a=(n("20d6"),n("7962")),o={name:"VideoUploader",props:{uploadFileFunc:{type:Function,default:function(){}},videoRemove:{type:Function,default:function(){}},handleChange:{type:Function,default:function(){}},handleFileError:{type:Function,default:function(){}},uploadLoading:{type:Boolean,default:!1},fileList:{type:Array,default:function(){return[]}},fileUrlList:{type:Array,default:function(){return[]}}},components:{Monitor:a["a"]},data:function(){return{monitorInfo:{}}},methods:{previewVideo:function(e){var t=this.fileList.findIndex((function(t){return t.uid===e.uid}));this.monitorInfo={type:"video",meta:{url:this.fileUrlList[t].url}},this.$refs.monitor.show()},videoExceed:function(){this.$message.warning("最多上传三个文件")},handleFileSuccess:function(){this.$message({message:"上传成功",type:"success"})},beforeFileUpload:function(e){var t=["video/mp4","video/avi","video/flv","video/wmv","video/mkv","video/mov"].indexOf(e.type)>=0;return t||this.$message.error("支持avi、flv、mp4、wmv、mkv、mov、等视频格式"),t}}},s=o,c=n("2877"),l=Object(c["a"])(s,i,r,!1,null,null,null);t["a"]=l.exports},7811:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"batch-container"},[n("el-form",{directives:[{name:"show",rawName:"v-show",value:"edit"===e.status,expression:"status === 'edit'"}],ref:"ruleForm",attrs:{"label-width":"100px",model:e.ruleForm}},[n("el-form-item",{attrs:{label:"服务类型",prop:"serviceType",rules:[{required:!0,message:"请选择",trigger:"change"}]}},[n("div",{staticStyle:{width:"30%"}},[n("el-select",{attrs:{placeholder:"请选择发送类型"},model:{value:e.ruleForm.serviceType,callback:function(t){e.$set(e.ruleForm,"serviceType",t)},expression:"ruleForm.serviceType"}},e._l(e.options,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),n("div",{staticClass:"baby-number"},[n("i",{staticClass:"iconfont icon-xuanze"}),e._v("  已选择"+e._s(e.babyList.length)+"个宝宝\n    ")]),n("div",{staticClass:"batch-tips"},[n("div",{staticClass:"batch-tips_title"},[e._v("温馨提示：")]),e._v("\n      发送成功后，所有宝宝的家长都会收到相同的内容，请注意称呼和内容措辞！\n      请注意一位家长为多个宝宝签约了服务的情况，用户会收到多条相同的消息\n    ")]),n("el-form-item",{attrs:{label:"标题",prop:"title",rules:[{required:!0,message:"请填写标题",trigger:"blur"}]}},[n("div",{staticClass:"input-container"},[n("el-input",{attrs:{maxlength:"20","show-word-limit":""},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}}),e._v("\n          \n        "),e.replace?n("svg-icon",{attrs:{"icon-class":"replace"}}):e._e()],1)]),n("el-form-item",{attrs:{label:"内容详情",prop:"content",rules:[{required:!0,message:"请填写内容详情",trigger:"change"}]}},[n("vue-editor",{attrs:{"use-custom-image-handler":!0,placeholder:"请输入内容详情"},on:{"image-added":e.handleImageAdded},model:{value:e.ruleForm.content,callback:function(t){e.$set(e.ruleForm,"content",t)},expression:"ruleForm.content"}})],1),e.ruleForm.delayDay?n("el-form-item",{attrs:{label:"延期原因",prop:"desc"}},[n("el-input",{attrs:{placeholder:"请填写延期原因，用户不可见",rows:"5",maxlength:"100","show-word-limit":"",type:"textarea"},model:{value:e.ruleForm.delayReason,callback:function(t){e.$set(e.ruleForm,"delayReason",t)},expression:"ruleForm.delayReason"}})],1):e._e(),n("el-form-item",[n("video-uploader",{ref:"videoUploader",attrs:{"handle-change":e.handleChange,"upload-file-func":e.uploadFileFunc,"video-remove":e.videoRemove,"handle-file-error":e.handleFileError,"upload-loading":e.uploadLoading,fileList:e.fileList,"file-url-list":e.ruleForm.contentVideos}})],1),n("el-form-item",[n("div",{staticClass:"button-container"},[n("el-button",{attrs:{type:"primary",disabled:e.uploadLoading},on:{click:e.handleSave}},[e._v("保存")]),n("el-button",{attrs:{disabled:e.uploadLoading},on:{click:e.preview}},[e._v("预览")])],1)])],1),"preview"===e.status?n("div",{staticClass:"preview-content"},[n("div",{staticClass:"success-item"},[n("div",{staticClass:"label"},[e._v("服务类型:")]),n("div",{staticClass:"content"},[e._v("\n        "+e._s(1===e.ruleForm.serviceType?"科普指导":"预防提醒")+"\n      ")])]),n("div",{staticClass:"baby-number",staticStyle:{"margin-left":"-40px"}},[n("i",{staticClass:"iconfont icon-xuanze"}),e._v("  已选择"+e._s(e.babyList.length)+"个宝宝\n    ")]),n("div",[n("send-content-preview",{attrs:{"rule-form":e.ruleForm,replace:e.replace}})],1),n("div",{staticClass:"button-container"},[n("el-button",{on:{click:e.returnEdit}},[e._v("返回修改")]),n("el-button",{attrs:{type:"primary",loading:e.loadingStatus},on:{click:e.send}},[e._v("发送")])],1)]):e._e()],1)},r=[],a=(n("7f7f"),n("96cf"),n("3b8d")),o=(n("20d6"),n("28a5"),n("5873")),s=n("91b6"),c=n("612f"),l=n("8dbe"),u=n("7b1f"),d=n("cded"),p={name:"BatchSend",components:{VueEditor:o["a"],VideoUploader:c["a"],SendContentPreview:l["a"]},data:function(){return{taskId:"",serviceType:"",loadingStatus:!1,replace:!1,uploadLoading:!1,monitorInfo:{},fileList:[],isSaved:!1,createdTaskId:"",status:"edit",ruleForm:{serviceType:null,title:"",content:"",contentPic:"",contentTxt:"",contentVideos:[]},options:[{value:1,label:"科普指导"},{value:2,label:"预防提醒"}],babyList:[]}},mounted:function(){this.babyList=this.$route.query.babyList.split(","),this.replace=this.$route.query.isReplace,this.serviceType=this.$route.query.serviceType,this.createdTaskId=this.$route.query.taskId,this.$route.query.serviceType&&this.getTaskContent()},methods:{videoRemove:function(e,t){var n=this.fileList.findIndex((function(t){return t.uid===e.uid}));this.ruleForm.contentVideos.splice(n,1)},handleChange:function(e,t){this.fileList=t},uploadFileFunc:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,i,r,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.uploadLoading=!0,n=t.file,e.next=4,Object(s["c"])(n,(function(e){}));case 4:i=e.sent,r=i.url,a=n.name,o={url:r,name:a},this.ruleForm.contentVideos.push(o),this.uploadLoading=!1;case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleFileError:function(){this.uploadLoading=!1},getTaskContent:function(){var e=this;Object(u["u"])(this.createdTaskId,{type:1}).then((function(t){if(2e4===t.code){var n=t.data,i=n.title,r=n.content,a=n.contentVideos,o=n.is_replace;e.ruleForm={serviceType:e.serviceType,title:i,content:r,contentVideos:a},e.replace=o,e.fileList=a}}))},send:function(){var e=this;this.loadingStatus=!0,Object(u["x"])(this.createdTaskId,{type:1}).then((function(t){2e4===t.code&&(e.$message.success("发送成功"),e.loadingStatus=!1,setTimeout((function(){e.$router.push({path:"/medical-service/batch-detail",query:{babyNum:e.babyList.length,taskId:e.createdTaskId}})}),2e3))}))},saveTask:function(){var e=this.ruleForm,t=e.title,n=e.content,i=e.serviceType,r={title:t,content:n,serviceType:i,babyList:this.babyList,contentPic:this.ruleForm.contentPic,contentTxt:this.getSimpleText(this.ruleForm.content),contentVideos:this.ruleForm.contentVideos,bus_user:this.$route.query.hm},a={taskId:this.createdTaskId};return Object(u["f"])(a,r)},handleSave:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return!1;e.saveTask().then((function(t){2e4===t.code&&(e.$message.success("保存成功"),e.isSaved=!0,e.createdTaskId=t.data._id)}))}))},preview:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return!1;e.isSaved?e.status="preview":e.saveTask().then((function(t){2e4===t.code&&(e.status="preview",e.createdTaskId=t.data._id)}))}))},getSimpleText:d["a"],handleImageAdded:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n,i){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["c"])(t,(function(e){}));case 2:r=e.sent,n.insertEmbed(i,"image",encodeURI(r.url)),this.ruleForm.contentPic||(this.ruleForm.contentPic=encodeURI(r.url));case 5:case"end":return e.stop()}}),e,this)})));function t(t,n,i){return e.apply(this,arguments)}return t}(),returnEdit:function(){this.status="edit"}}},f=p,v=(n("e5f4"),n("3be2"),n("2877")),m=Object(v["a"])(f,i,r,!1,null,"cbfe7fcc",null);t["default"]=m.exports},"8dbe":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"preview"},[n("div",{staticClass:"preview__title"},[e._v("\n      "+e._s(e.ruleForm.title)+"  \n      "),e.replace?n("svg-icon",{attrs:{"icon-class":"replace"}}):e._e()],1),n("div",{staticClass:"preview__content rich-text rich-text__image--max380",domProps:{innerHTML:e._s(e.ruleForm.content)}})]),e.ruleForm.contentVideos&&e.ruleForm.contentVideos.length>0?n("div",e._l(e.ruleForm.contentVideos,(function(e){var t=e.url;return n("div",{key:t,staticStyle:{"text-align":"center"}},[n("video-item",{attrs:{url:t}})],1)})),0):e._e()])},r=[],a=n("d537"),o={name:"SendContentPreview",components:{VideoItem:a["a"]},props:{ruleForm:{type:Object,default:function(){}},replace:{type:Boolean,default:!1}}},s=o,c=(n("daa3"),n("2877")),l=Object(c["a"])(s,i,r,!1,null,"38b1573a",null);t["a"]=l.exports},"91b6":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return u}));n("7f7f"),n("386d"),n("28a5");var i=n("db72"),r=(n("96cf"),n("3b8d")),a=n("b775"),o=function(){return Object(a["a"])({url:"/oss/auth",method:"get"})},s=function(e){return Object(a["a"])({url:e+"?x-oss-process=image/info",method:"get"})},c=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,o,c,l,u,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.oss,r=t.key,o=t.file,c=t.onProgress,l=new FormData,l.append("OSSAccessKeyId",n.OSSAccessKeyId),l.append("success_action_status",200),l.append("policy",n.policy),l.append("Signature",n.Signature),l.append("key",r),l.append("file",o),u="https://pic1.baobaohehu.com/",e.next=11,Object(a["a"])({url:u,method:"post",headers:{"Content-Type":"multipart/form-data"},onUploadProgress:c||null,data:l});case 11:if(u+=r,!(o.type.indexOf("image")>-1)){e.next=18;break}return e.next=15,s(u);case 15:d=e.sent,e.next=27;break;case 18:if(!(o.type.indexOf("video")>-1)){e.next=22;break}d=Object(i["a"])({},o.videoMeta,{size:o.size}),e.next=27;break;case 22:if(!(o.type.indexOf("audio")>-1)){e.next=26;break}d={size:o.size,type:o.type},e.next=27;break;case 26:throw new Error("当前上传的类型不是image或者video；当前上传的类型是"+o.type);case 27:return e.abrupt("return",{url:u,meta:d});case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(e){if(!e||"string"!==typeof e)return!1;var t=e.split("").reverse().join(""),n=t.substring(0,t.search(/\./)).split("").reverse().join("");return n},u=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var i,r,a,s,u,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o();case 2:return i=e.sent,r=i.data,a=Math.floor(99*Math.random())+1,s=(new Date).getTime(),u=l(t.name),s=s+a+"."+u,d="".concat(r.path,"/").concat(r.prefix,"/").concat(s),e.next=11,c({oss:r,key:d,file:t,onProgress:n});case 11:return p=e.sent,e.abrupt("return",p);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},"95c2":function(e,t,n){},"9b53":function(e,t,n){},c2d7:function(e,t,n){},cded:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));n("a481"),n("3b2b"),n("a18c");var i=function(e){switch(e.vaccine_type){case 1:return"减毒";case 2:return"灭活";case 3:return"多糖"}},r=function(e){switch(e.vaccine_class){case 1:return"一类";case 2:return"二类"}},a=function(e){var t=new RegExp("<.+?>","g"),n=e.replace(t,"");return n.length>38?n.slice(0,38)+"...":n},o=[{value:0,label:"待发送"},{value:2,label:"已保存"},{value:3,label:"已发送"},{value:1,label:"留言待回复"},{value:4,label:"已完成"},{value:5,label:"已取消"},{value:6,label:"已关闭"},{value:100,label:"延期"}]},d537:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"video-container"},[n("img",{attrs:{src:e.url+"?x-oss-process=video/snapshot,t_0,w_0,h_0,f_jpg",width:"480"}}),n("div",{staticClass:"video-container__play-icon",on:{click:function(t){return e.showMediaDetail(e.url)}}},[n("div",{staticClass:"el-icon-video-play"})]),n("monitor",{ref:"monitor",attrs:{"monitor-info":e.monitorInfo}})],1)])},r=[],a=n("7962"),o={name:"VideoItem",components:{Monitor:a["a"]},props:{url:{type:String,default:""}},data:function(){return{monitorInfo:{}}},methods:{showMediaDetail:function(e){this.monitorInfo={type:"video",meta:{url:e}},this.$refs.monitor.show()}}},s=o,c=(n("350a"),n("2877")),l=Object(c["a"])(s,i,r,!1,null,"df4e0e06",null);t["a"]=l.exports},daa3:function(e,t,n){"use strict";var i=n("95c2"),r=n.n(i);r.a},dc73:function(e,t,n){},e5f4:function(e,t,n){"use strict";var i=n("dc73"),r=n.n(i);r.a}}]);
//# sourceMappingURL=chunk-08ed63aa.91fec7d1.js.map