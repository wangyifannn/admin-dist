(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-793054a0"],{"0621":function(t,e,n){},6761:function(t,e,n){"use strict";var i=n("0621"),a=n.n(i);a.a},"7cdf":function(t,e,n){var i=n("5ca1");i(i.S,"Number",{isInteger:n("9c12")})},"9c12":function(t,e,n){var i=n("d3f4"),a=Math.floor;t.exports=function(t){return!i(t)&&isFinite(t)&&a(t)===t}},a576:function(t,e,n){"use strict";var i=n("c364"),a=n.n(i);a.a},b7be:function(t,e,n){"use strict";n.d(e,"h",(function(){return a})),n.d(e,"b",(function(){return r})),n.d(e,"i",(function(){return o})),n.d(e,"j",(function(){return s})),n.d(e,"k",(function(){return c})),n.d(e,"g",(function(){return l})),n.d(e,"f",(function(){return d})),n.d(e,"e",(function(){return u})),n.d(e,"a",(function(){return _})),n.d(e,"d",(function(){return m})),n.d(e,"c",(function(){return f}));var i=n("b775");function a(t){return Object(i["a"])({url:"/trade/quanyi",method:"get",params:t})}function r(t){return Object(i["a"])({url:"/trade/quanyi",method:"post",data:t})}function o(t){return Object(i["a"])({url:"/trade/quanyi/".concat(t),method:"get"})}function s(t,e){return Object(i["a"])({url:"/trade/quanyi/".concat(t),method:"put",data:e})}function c(t,e){return Object(i["a"])({url:"/trade/quanyi/".concat(t,"/status"),method:"put",data:e})}function l(t){return Object(i["a"])({url:"/discount_coupon/list",method:"get",params:t})}function d(){return Object(i["a"])({url:"/discount_coupon/filter",method:"get"})}function u(){return Object(i["a"])({url:"/discount_coupon/create_info",method:"get"})}function _(t){return Object(i["a"])({url:"/discount_coupon",method:"post",data:t})}function m(t){return Object(i["a"])({url:"discount_coupon/".concat(t,"/create_qrcode"),method:"put"})}function f(t){return Object(i["a"])({url:"/discount_coupon/"+t._id+"/change_status",method:"put",data:t})}},c364:function(t,e,n){},cb12:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"coupon-add"},[n("div",{staticClass:"coupon-add__preview"},[n("div",{staticClass:"phone-background"}),n("div",{staticClass:"preview-content"},[n("div",[t._v("优惠券名称："+t._s(t.form.name))]),n("div",[t._v("\n        优惠形式：\n        "),"discount_money"===t.form.discount_type?n("span",[t._v("\n          ¥\n          "+t._s(t.form.discount_money?t.fenToYuan(100*Number(t.form.discount_money)):"")+"\n        ")]):"discount_rate"===t.form.discount_type?n("span",[t._v("\n          "+t._s(t.form.discount_rate?Number(t.form.discount_rate).toFixed(1):"")+"\n          折\n        ")]):t._e()]),n("div",[t._v("使用范围："+t._s(t.application))]),n("div",[t._v("\n        有效期：\n        "),"data_range"===t.form.valid_day_type?n("span",[t._v("\n          "+t._s(t._f("formatTime")(new Date(t.validDateRange[0]),"y-m-d"))+" 到\n          "+t._s(t._f("formatTime")(new Date(t.validDateRange[1]),"y-m-d"))+"\n        ")]):"current_day"===t.form.valid_day_type?n("span",[t._v("\n          领到券当日开始"+t._s(t.currentValid)+"天内有效\n        ")]):"next_day"===t.form.valid_day_type?n("span",[t._v("\n          领到券次日开始"+t._s(t.nextDayValid)+"天内有效\n        ")]):t._e()]),n("div",[t._v("使用说明："+t._s(t.form.use_desc))])])]),n("div",{staticClass:"coupon-add__form"},[n("div",{staticClass:"coupon-add__form--title"},[t._v("\n       优惠券信息\n    ")]),n("div",{staticClass:"coupon-add__form--content"},[n("el-form",{ref:"couponForm",attrs:{model:t.form,"label-width":"120px"}},[n("div",{staticStyle:{width:"600px"}},[n("el-form-item",{attrs:{label:"优惠券名称：",prop:"name",rules:[{required:!0,message:"请输入标题",trigger:"blur"}]}},[n("el-input",{attrs:{placeholder:"请输入",maxlength:"20","show-word-limit":""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),n("el-form-item",{attrs:{label:"发放总量：",prop:"total",rules:[{required:!0,message:"请输入发放总量",trigger:"blur"},{validator:t.checkPositiveInt,trigger:"blur"}]}},[n("div",{staticStyle:{display:"flex"}},[n("div",{staticStyle:{width:"220px"}},[n("el-input",{attrs:{placeholder:"请输入正整数"},model:{value:t.form.total,callback:function(e){t.$set(t.form,"total",t._n(e))},expression:"form.total"}})],1),n("div",[t._v("\n                  张\n            ")])])]),n("el-form-item",{attrs:{label:"优惠形式：",prop:"discount_type",rules:[{required:!0,message:"请输入优惠形式",trigger:"change"},{validator:t.checkDiscount,trigger:"blur"}]}},[n("div",{staticClass:"preferential"},[n("el-radio-group",{on:{change:t.discountTypeChange},model:{value:t.form.discount_type,callback:function(e){t.$set(t.form,"discount_type",e)},expression:"form.discount_type"}},[n("el-radio",{attrs:{label:"discount_money"}},[t._v("指定金额 ")]),n("div",{staticClass:"preferential-num"},[n("div",{staticStyle:{"margin-left":"20px",width:"200px"}},[n("el-input",{attrs:{disabled:"discount_money"!=t.form.discount_type},model:{value:t.form.discount_money,callback:function(e){t.$set(t.form,"discount_money",e)},expression:"form.discount_money"}})],1),n("div",{staticStyle:{"font-size":"14px"}},[t._v("\n                      元\n                ")])]),n("el-radio",{attrs:{label:"discount_rate"}},[t._v("指定折扣")]),n("div",{staticClass:"preferential-num"},[n("div",{staticStyle:{"margin-left":"20px",width:"200px"}},[n("el-input",{attrs:{disabled:"discount_rate"!=t.form.discount_type},model:{value:t.form.discount_rate,callback:function(e){t.$set(t.form,"discount_rate",e)},expression:"form.discount_rate"}})],1),n("div",{staticStyle:{"font-size":"14px"}},[t._v("\n                      折\n                ")])])],1)],1)]),n("el-form-item",{attrs:{label:"使用范围：",rules:[{required:!0,message:"",trigger:"blur"}]}},[n("div",{staticClass:"range"},[n("el-checkbox",{on:{change:t.onSingleChecked},model:{value:t.singleAsk,callback:function(e){t.singleAsk=e},expression:"singleAsk"}},[t._v("单次问诊")]),n("br"),t.singleAsk?n("div",{staticClass:"ask-doctor"},[n("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),n("el-checkbox-group",{on:{change:t.handleCheckedDoctorsChange},model:{value:t.checkedDoctors,callback:function(e){t.checkedDoctors=e},expression:"checkedDoctors"}},[n("div",{staticClass:"doctor-checkbox"},t._l(t.doctors,(function(e){return n("el-checkbox",{key:e._id,attrs:{label:e._id}},[n("div",[t._v("\n                      "+t._s(e.name)+"\n                    ")]),t._l(e.single_ask_price_info,(function(e,i){return n("div",{key:"single"+i},[n("div",[t._v("\n                        "+t._s("pediatric"===e.department?"儿科":"产科")+":  ¥ "+t._s(t.fenToYuan(e.price))+"\n                      ")])])}))],2)})),1)])],1):t._e(),n("el-checkbox-group",{model:{value:t.rangeList,callback:function(e){t.rangeList=e},expression:"rangeList"}},t._l(t.packages,(function(e){return n("div",{key:e.value},[n("el-checkbox",{attrs:{label:e.value}},[t._v("\n                  "+t._s(e.label)+"\n                ")])],1)})),0)],1)]),n("el-form-item",[n("div",{staticClass:"tips-wrap"},[n("div",{staticClass:"jiantou"}),n("div",{staticStyle:{"font-weight":"bolder",color:"#F8747F"}},[t._v("\n              温馨提示：\n            ")]),t._v("\n            当前开启的家庭医生用户权益有\n            "),t._l(t.fdRights,(function(e,i){return n("span",{key:e,staticStyle:{color:"#F8747F"}},[t._v(t._s(e)),i!==t.fdRights.length-1?n("span",[t._v("、")]):t._e()])})),t._v("\n            ，该优惠券将在权益优惠执行后叠加，请注意成本控制！\n          ")],2)]),n("el-form-item",{attrs:{label:"每人限领：",prop:"preson_limit_num",rules:[{required:!0,message:"请输入发放总量",trigger:"change"}]}},[n("div",[n("el-select",{model:{value:t.form.preson_limit_num,callback:function(e){t.$set(t.form,"preson_limit_num",e)},expression:"form.preson_limit_num"}},t._l(t.limitOptions(),(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),n("el-form-item",{attrs:{label:"有效期：",prop:"valid_day_type",rules:[{required:!0,message:"选择有效期",trigger:"change"},{validator:t.checkValidDay,trigger:"change"}]}},[n("div",{staticClass:"preferential"},[n("el-radio-group",{on:{change:t.validDayTypeChange},model:{value:t.form.valid_day_type,callback:function(e){t.$set(t.form,"valid_day_type",e)},expression:"form.valid_day_type"}},[n("el-radio",{attrs:{label:"data_range"}},[t._v("固定日期 ")]),n("div",{staticClass:"preferential-num",staticStyle:{"margin-bottom":"40px"}},[n("el-date-picker",{attrs:{disabled:!("data_range"==t.form.valid_day_type),type:"daterange","picker-options":t.pickerOptions,"range-separator":"-","start-placeholder":"请选择时间范围起始","end-placeholder":"请选择时间范围结束"},model:{value:t.validDateRange,callback:function(e){t.validDateRange=e},expression:"validDateRange"}})],1),n("el-radio",{attrs:{label:"current_day"}},[n("div",{staticClass:"preferential-num",staticStyle:{position:"relative",top:"-40px",left:"20px"}},[n("div",[t._v("领到券当日开始   ")]),n("div",{staticStyle:{width:"192px"}},[n("el-input",{attrs:{disabled:!("current_day"==t.form.valid_day_type)},model:{value:t.currentValid,callback:function(e){t.currentValid=e},expression:"currentValid"}})],1),n("div",[t._v("   天内有效")])])]),n("br"),n("el-radio",{attrs:{label:"next_day"}},[n("div",{staticClass:"preferential-num",staticStyle:{position:"relative",top:"-40px",left:"20px"}},[n("div",[t._v("领到券次日开始   ")]),n("div",{staticStyle:{width:"192px"}},[n("el-input",{attrs:{disabled:!("next_day"==t.form.valid_day_type)},model:{value:t.nextDayValid,callback:function(e){t.nextDayValid=e},expression:"nextDayValid"}})],1),n("div",[t._v("   天内有效")])])])],1)],1)]),n("el-form-item",{attrs:{label:"使用说明：",prop:"use_desc",rules:[{required:!0,message:"请输入发放总量",trigger:"blur"}]}},[n("el-input",{attrs:{type:"textarea",maxlength:"100","show-word-limit":"",rows:"4",placeholder:"请输入"},model:{value:t.form.use_desc,callback:function(e){t.$set(t.form,"use_desc",e)},expression:"form.use_desc"}})],1),n("el-form-item",[n("div",{staticStyle:{"text-align":"center"}},[n("el-button",{attrs:{type:"primary"},on:{click:t.submitCoupon}},[t._v("提交")]),n("el-button",{on:{click:t.cancelCoupon}},[t._v("取消")])],1)])],1)],1)]),n("el-dialog",{attrs:{title:"提交优惠券提示",visible:t.dialogVisible,width:"30%",center:""},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("span",[t._v("操作成功后，该优惠券信息将不可修改，确认无误请单击下方【确认创建】按钮")]),n("div",{staticStyle:{"margin-top":"30px","text-align":"right"}},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.confirmSubmit}},[t._v("确认创建")])],1)])],1)},a=[],r=(n("c5f6"),n("7cdf"),n("7f7f"),n("6762"),n("2fdb"),n("b7be")),o=n("8975"),s=n("f1c9"),c=n("61f7"),l={name:"Add",data:function(){return{singleAsk:!1,checkAll:!1,checkedDoctors:[],doctors:[],isIndeterminate:!1,dialogVisible:!1,pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},rangeList:[],form:{name:"",total:null,discount_type:null,discount_money:null,discount_rate:null,fd_servie_types:null,single_ask_doctors:[],preson_limit_num:null,valid_day_type:null,valid_day_start:null,valid_day_end:null,use_desc:null},currentValid:null,nextDayValid:null,validDateRange:"",packages:[],fdRights:[]}},computed:{application:function(){var t=this,e="";if(this.singleAsk&&this.checkedDoctors.length>0){e="单次问诊";var n=this.doctors.filter((function(e){return t.checkedDoctors.includes(e._id)})).map((function(t){return t.name}));e+="("+n.join(" ")+")  "}var i=this.packages.filter((function(e){return t.rangeList.includes(e.value)})),a=i.map((function(t){return t.name})),r=a.join(" ");return e+r}},created:function(){var t=this;Object(r["e"])().then((function(e){var n=e.data;t.fdRights=n.fd_rigins.map((function(t){return t.name})),t.doctors=n.single_ask_users.list})),this.getProducts()},methods:{onSingleChecked:function(){this.checkAll=!1,this.checkedDoctors=[],this.isIndeterminate=!1},handleCheckAllChange:function(t){this.checkedDoctors=t?this.doctors.map((function(t){return t._id})):[],this.isIndeterminate=!1},handleCheckedDoctorsChange:function(t){var e=t.length;this.checkAll=e===this.doctors.length,this.isIndeterminate=e>0&&e<this.doctors.length},getProducts:function(){var t=this,e={show_history:0};Object(s["d"])(e).then((function(e){var n=e.data.list;t.packages=n.map((function(t){return{value:t.batch_id,label:"".concat(t.title," ").concat(t.sub_title,"   (").concat(t.version," ¥").concat(t.price/100,".00)"),name:t.title+" "+t.sub_title}}))}))},fenToYuan:o["fenToYuan"],validDayTypeChange:function(t){"data_range"===t?(this.currentValid="",this.nextDayValid=""):"current_day"===t?(this.nextDayValid="",this.validDateRange=""):"next_day"===t&&(this.currentValid="",this.validDateRange="")},discountTypeChange:function(t){"discount_money"===t?this.form.discount_rate="":"discount_rate"===t&&(this.form.discount_money="")},checkPositiveInt:function(t,e,n){if(""===e)return n(new Error("不能为空"));setTimeout((function(){!Number.isInteger(e)||Number(e)<0?n(new Error("请输入正整数")):n()}),10)},checkDiscount:function(t,e,n){var i=this;setTimeout((function(){"discount_rate"===e?i.form.discount_rate&&Object(c["b"])(i.form.discount_rate)?n():n(new Error("请输入正确格式的优惠金额或折扣")):"discount_money"===e&&(i.form.discount_money&&Object(c["c"])(i.form.discount_money)?n():n(new Error("请输入正确格式的优惠金额或折扣"))),n()}),10)},checkValidDay:function(t,e,n){n()},cancelCoupon:function(){this.$refs.couponForm.resetFields(),this.form={name:"",total:null,discount_type:null,discount_money:null,discount_rate:null,fd_servie_types:null,single_ask_doctors:[],preson_limit_num:null,valid_day_type:null,valid_day_start:null,valid_day_end:null,valid_duration:null,use_desc:null},this.rangeList=[],this.currentValid=null,this.nextDayValid=null,this.validDateRange=""},confirmSubmit:function(){var t=this,e={name:this.form.name,total:this.form.total,discount_type:this.form.discount_type,discount_money:this.form.discount_money,discount_rate:this.form.discount_rate,fd_service_types:this.rangeList,single_ask_doctors:this.checkedDoctors,preson_limit_num:this.form.preson_limit_num,valid_day_type:this.form.valid_day_type,valid_day_start:this.validDateRange[0],valid_day_end:this.validDateRange[1],valid_duration:this.nextDayValid||this.currentValid,use_desc:this.form.use_desc,use_range_type_value:this.application};Object(r["a"])(e).then((function(e){2e4===e.code&&(t.$message.success("新增优惠券成功"),t.dialogVisible=!1,t.$router.back(-1))}))},submitCoupon:function(){var t=this;this.$refs.couponForm.validate((function(e){if(!e)return console.log("error submit!!"),!1;if("discount_money"!==t.form.discount_type||t.form.discount_money&&Object(c["c"])(t.form.discount_money))if("discount_rate"!==t.form.discount_type||t.form.discount_rate&&Object(c["b"])(t.form.discount_rate)){var n=t.nextDayValid||t.currentValid;"data_range"===t.form.valid_day_type||n&&Object(c["c"])(n)?"data_range"!==t.form.valid_day_type||t.validDateRange?0!==t.rangeList.length||0!==t.checkedDoctors.length?t.dialogVisible=!0:t.$message.warning("请选择使用范围"):t.$message.warning("请选择正确的优惠券有效期范围"):t.$message.warning("请输入正确的优惠券有效期")}else t.$message.warning("请输入正确的优惠折扣(数字类型，小数点后保留一位)");else t.$message.warning("请输入正确的优惠金额（数字类型，小数点后最多保留两位）")}))},limitOptions:function(){for(var t=[{label:"不限制",value:-100}],e=0;e<10;e++)t.push({label:e+1+"张",value:e+1});return t}}},d=l,u=(n("6761"),n("a576"),n("2877")),_=Object(u["a"])(d,i,a,!1,null,"2ec783aa",null);e["default"]=_.exports},f1c9:function(t,e,n){"use strict";n.d(e,"d",(function(){return a})),n.d(e,"a",(function(){return r})),n.d(e,"e",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"f",(function(){return c})),n.d(e,"c",(function(){return l}));var i=n("b775");function a(t){return Object(i["a"])({url:"/fd/products",method:"get",params:t})}function r(t){return Object(i["a"])({url:"/fd/products",method:"post",data:t})}function o(t,e){return Object(i["a"])({url:"/fd_service_type/services",method:"get",params:e})}function s(t,e){return Object(i["a"])({url:"/fd/products/".concat(t,"/status"),method:"put",data:e})}function c(t,e){return Object(i["a"])({url:"/fd/products/".concat(t),method:"put",data:e})}function l(t){return Object(i["a"])({url:"/fd/products/".concat(t),method:"get"})}}}]);
//# sourceMappingURL=chunk-793054a0.81bec31a.js.map