(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d306fcd"],{"063e":function(e,t,r){"use strict";var n=r("5ad2"),a=r.n(n);a.a},"5ad2":function(e,t,r){},"70d1":function(e,t,r){},"8ee3":function(e,t,r){"use strict";var n=r("70d1"),a=r.n(n);a.a},c081:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"role"},[r("div",{staticClass:"role__header"},[r("el-input",{staticClass:"role__header__item role__header__search",attrs:{size:"small",placeholder:"请输入权限组名称搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.searchName,callback:function(t){e.searchName="string"===typeof t?t.trim():t},expression:"searchName"}}),r("el-button",{staticClass:"role__header__item",attrs:{type:"primary",size:"small"},on:{click:e.handleSearchByName}},[e._v("搜索")]),r("el-button",{staticClass:"role__header__item",attrs:{type:"primary",size:"small"},on:{click:e.handleAddRole}},[e._v("新增")]),r("el-button",{staticClass:"role__header__item",attrs:{type:"primary",size:"small",plain:""},on:{click:e.handleReset}},[e._v("重置")])],1),r("div",{staticClass:"role__body"},[r("div",{staticClass:"el-card-warpper role__body__list"},[r("el-card",{staticClass:"el-card--no-shadow el-card--header-nbb el-card--flex"},[r("div",{staticClass:"el-card__header__flex-warpper",attrs:{slot:"header"},slot:"header"},[r("span",{staticClass:"el-card__header__title"},[e._v("权限组列表")]),r("el-button-group",e._l(e.permissionTreeTypes,(function(t){return r("el-button",{key:t,attrs:{size:"medium",type:e.curPermissionTypeTree===t?"primary":""},on:{click:function(r){return e.handleChangeTreeType(t)}}},[e._v(e._s(e._f("permissionType")(t)))])})),1)],1),r("el-table",{staticClass:"role__body__list__table",attrs:{data:e.rolesList,"empty-text":"暂无数据，请输入正确的权限组名称"},on:{"row-click":e.handleRowClick}},[r("el-table-column",{attrs:{align:"center",label:"",width:"60",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"role__body__list__table-checkbox-wrapper",on:{click:function(){}}},[r("div",{staticClass:"role__body__list__table-checkbox-mask"}),r("el-checkbox",{attrs:{disabled:"superAdmin"===t.row.key},model:{value:t.row.checked,callback:function(r){e.$set(t.row,"checked",r)},expression:"scope.row.checked"}})],1)]}}])}),r("el-table-column",{attrs:{align:"center",label:"权限组名称",width:"150",fixed:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.name)+"\n            ")]}}])}),r("el-table-column",{attrs:{align:"center",label:"权限组描述","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.description)+"\n            ")]}}])}),r("el-table-column",{attrs:{align:"center",label:"创建日期","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(e._f("formatTime")(t.row.insertTime,"{y}-{m}-{d}"))+"\n            ")]}}])}),r("el-table-column",{attrs:{align:"center",label:"最后编辑日期","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.updateTime?[e._v("\n              "+e._s(e._f("formatTime")(t.row.updateTime,"{y}-{m}-{d}"))+"\n            ")]:void 0}}],null,!0)}),r("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:t.row.editable?"primary":"info",size:"mini",icon:"el-icon-edit",disabled:!t.row.editable},on:{click:function(r){return r.stopPropagation(),e.handleEdit(t)}}}),r("el-button",{attrs:{type:t.row.removeable?"danger":"info",size:"mini",icon:"el-icon-delete",disabled:!t.row.removeable},on:{click:function(r){return r.stopPropagation(),e.handleDelete(t)}}})]}}])})],1),r("div",{staticClass:"role__body__list__pagination"},[r("el-pagination",{attrs:{"current-page":e.page.currentPage,"page-sizes":e.pageSizes,"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1),r("div",{staticClass:"el-card-warpper role__body__tree"},[r("el-card",{staticClass:"el-card--no-shadow"},[r("div",{staticClass:"el-card__header__flex-warpper el-card__header__flex-warpper--align-center",attrs:{slot:"header"},slot:"header"},[r("span",{staticClass:"el-card__header__title"},[e._v(e._s(e._f("permissionType")(e.curPermissionTypeTree)))]),r("el-button",{attrs:{type:"primary",size:"small",disabled:Boolean(!e.role.id)},on:{click:e.handleSaveTree}},[e._v("保存")])],1),r("el-tree",{ref:"tree",attrs:{data:e.treeDate,"show-checkbox":"","default-expand-all":"","node-key":"path",props:e.defaultProps},on:{"check-change":e.checkChange}})],1)],1)]),r("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑权限组":"新增权限组",width:"450px",top:"25vh",center:""},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.handleResetForm}},[r("el-form",{ref:"roleForm",attrs:{model:e.role,"label-width":"100px","label-position":"right",rules:e.roleFormRules,"append-to-body":!0}},[r("el-form-item",{attrs:{label:"权限组名称",prop:"name"}},[r("el-input",{attrs:{size:"small"},model:{value:e.role.name,callback:function(t){e.$set(e.role,"name","string"===typeof t?t.trim():t)},expression:"role.name"}})],1),r("el-form-item",{staticClass:"description_item",attrs:{label:"权限组描述",prop:"description"}},[r("el-input",{attrs:{autosize:{minRows:4,maxRows:4},type:"textarea"},on:{input:e.changeSize},model:{value:e.role.description,callback:function(t){e.$set(e.role,"description",t)},expression:"role.description"}}),r("i",{staticClass:"fontsize10 textarea_tip"},[e._v(e._s(e.descriptionSize)+"/100")])],1)],1),r("div",{staticStyle:{"text-align":"center"}},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirmRole}},[e._v("\n        "+e._s("edit"===e.dialogType?"保存修改":"确认新增")+"\n      ")])],1)],1)],1)},a=[],i=(r("7f7f"),r("ac4d"),r("8a81"),r("db72")),s=(r("ac6a"),r("96cf"),r("3b8d")),c=r("ed08"),o=r("cc5e"),l=r("a18c"),u=r("2ef0"),d=r.n(u),h={key:"",id:"",name:"",description:"",insertTime:"",editable:!0,removeable:!1,backEndAccess:[],routes:[]},p={filters:{permissionType:function(e){switch(e){case"api":return"权限分配";case"fontend-routes":return"菜单分配";default:throw new Error("不能识别的权限类型")}}},data:function(){return{saveDisabled:!0,descriptionSize:0,role:Object.assign({},h),roleFormRules:{name:[{required:!0,message:"请输入权限组名称",trigger:"blur"}],description:[{min:0,max:100,message:"修改理由最多为100个字符",trigger:"blur"},{min:0,max:100,message:"修改理由最多为100个字符",trigger:"change"}]},routes:[],apiAccessTree:[],rolesList:[],searchName:"",dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"},curPermissionTypeTree:"api",permissionTreeTypes:["api","fontend-routes"],page:{total:0,pageSize:10,currentPage:1},pageSizes:[10,50,100]}},computed:{routesData:function(){return this.routes},treeDate:function(){var e="api"===this.curPermissionTypeTree?this.apiAccessTree:this.routesData;return e}},watch:{"role.id":function(e){this.handleChangeTreeType(this.curPermissionTypeTree)}},created:function(){this.getApiAccessTree(),this.getRoutes(),this.handleSearch()},methods:{checkChange:function(e,t,r){this.saveDisabled=!t||!t},changeSize:function(){this.descriptionSize=this.role.description.length},getRoutes:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.routes=this.generateRoutes(l["a"]);case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getApiAccessTree:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["c"])();case 2:t=e.sent,this.apiAccessTree=this.changeKeyIdToPath(t.data);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),changeKeyIdToPath:function(e){var t=this,r=[];return e.forEach((function(e){var n=e.id,a=e.label,i=e.children,s={path:n,title:a};i&&(s.children=t.changeKeyIdToPath(i)),r.push(s)})),r},setTableData:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.list,this.rolesList=r.map((function(e){if(e.checked=!1,e.routes=e.fontEndAccess,e.description=e.describe,e.id=e._id,e.key||(e.key=e._id),delete e.fontEndAccess,delete e.describe,delete e._id,n.role.id&&n.role.id===e.id){var t=Object.assign(e,{checked:n.role.checked});n.role=Object(c["c"])(t)}return e}));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),setPage:function(e){var t=e.currentPage,r=e.pageSize,n=e.count;this.page.currentPage=t,this.page.pageSize=r,this.page.total=n},handleSearchByName:function(){this.searchName?this.handleSearch():this.$message({message:"输入权限组名称搜索",type:"error"})},handleSearch:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t||{},r.currentPage||(r.currentPage=this.page.currentPage),r.pageSize||(r.pageSize=this.page.pageSize),r.search=this.searchName,e.next=6,Object(o["d"])(r);case 6:if(n=e.sent,a=n.data,!(0===a.list.length&&this.page.currentPage>1)){e.next=14;break}return this.handleSearch(Object.assign(r,{currentPage:1})),this.setPage({currentPage:1,pageSize:10,total:0}),e.abrupt("return");case 14:this.setPage(Object(i["a"])({},a));case 15:this.setTableData(Object(i["a"])({},a));case 16:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),generateRoutes:function(e){var t=[],r=!0,n=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;if(!c.hidden){var o={path:c.r_id,title:c.meta&&c.meta.title};c.children&&(o.children=this.generateRoutes(c.children)),t.push(o)}}}catch(l){n=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return t},handleAddRole:function(){this.role=Object.assign({},h),this.dialogType="new",this.dialogVisible=!0},handleReset:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.searchName="",e.next=3,this.handleSearch();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),resetTreeChecked:function(){this.$refs.tree&&this.$refs.tree.setCheckedKeys([])},handleChangeTreeType:function(e){if(this.curPermissionTypeTree=e,""!==this.role.id)if("api"===e)this.$refs.tree.setCheckedKeys(this.role.backEndAccess);else if("fontend-routes"===e){for(var t=this.role.routes,r=[],n=0;n<this.treeDate.length;n++)r.push(this.treeDate[n].path);t=d.a.difference(t,r),this.$refs.tree.setCheckedKeys(t,!1)}else this.resetTreeChecked();else this.resetTreeChecked()},handleRowClick:function(e){var t=this,r=e.key,n=!!e.fromHandleBtn;"superAdmin"!==r?this.rolesList=this.rolesList.map((function(a){return a.key===r?(a.checked=n||!a.checked,a.checked?t.role=Object(c["c"])(e):t.role=Object.assign({},h)):a.checked=!1,a})):this.resetTreeChecked()},handleEdit:function(e){var t=e.row;this.dialogType="edit",this.dialogVisible=!0,this.handleRowClick(Object(i["a"])({},t,{fromHandleBtn:!0})),this.descriptionSize=t.description.length},handleDelete:function(e){var t=this,r=(e.$index,e.row);this.handleRowClick(Object(i["a"])({},r,{fromHandleBtn:!0})),this.$confirm("删除后，该权限组信息系统将不再保留，确认删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["b"])(r.id);case 2:return e.next=4,t.handleSearch();case 4:t.$message({type:"success",message:"删除成功！"});case 5:case"end":return e.stop()}}),e)})))).catch((function(e){console.error(e)}))},confirmRole:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs["roleForm"].validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(r){var n,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!r){e.next=18;break}if(n="edit"===t.dialogType,!n){e.next=9;break}return e.next=5,Object(o["g"])(t.role.id,{name:t.role.name,describe:t.role.description});case 5:a=e.sent,t.$message({type:a&&2e4===a.code?"success":"error",message:a.message}),e.next=13;break;case 9:return e.next=11,Object(o["a"])({name:t.role.name,describe:t.role.description});case 11:i=e.sent,t.$message({type:i&&2e4===i.code?"success":"error",message:i.message});case 13:return e.next=15,t.handleSearch();case 15:t.dialogVisible=!1,e.next=19;break;case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleResetForm:function(){this.$refs["roleForm"].resetFields()},handleCurrentChange:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.handleSearch({currentPage:t});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleSizeChange:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.handleSearch({pageSize:t});case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleSaveTree:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("api"!==this.curPermissionTypeTree){e.next=6;break}return t=this.$refs.tree.getCheckedKeys(!0),e.next=4,Object(o["f"])(this.role.id,{access:t}).then(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.$message({type:"success",message:"保存成功！"}),e.next=3,a.handleSearch();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:e.next=11;break;case 6:if("fontend-routes"!==this.curPermissionTypeTree){e.next=11;break}return r=this.$refs.tree.getCheckedNodes(!1,!0),n=r.map((function(e){return e.path})),e.next=11,Object(o["h"])(this.role.id,{access:n}).then(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.$message({type:"success",message:"保存成功！"}),e.next=3,a.handleSearch();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},f=p,m=(r("8ee3"),r("063e"),r("2877")),g=Object(m["a"])(f,n,a,!1,null,"0fa77aee",null);t["default"]=g.exports}}]);
//# sourceMappingURL=chunk-3d306fcd.d0fbef99.js.map