(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a9e4c3e2"],{"0106":function(e,t,a){"use strict";var s=a("3654"),n=a.n(s);n.a},3654:function(e,t,a){},8702:function(e,t,a){"use strict";var s=a("fbcf"),n=a.n(s);n.a},"8aa2":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"i",(function(){return r})),a.d(t,"h",(function(){return i})),a.d(t,"g",(function(){return l})),a.d(t,"a",(function(){return o})),a.d(t,"e",(function(){return c})),a.d(t,"d",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"f",(function(){return m}));var s=a("b775");function n(e){return Object(s["a"])({url:"/task_manager/chanke/task",method:"post",data:e})}function r(e){return Object(s["a"])({url:"/task_manager/chanke/task_message",method:"post",data:e})}function i(e,t){return Object(s["a"])({url:"/task_manager/chanke/task/".concat(e,"/save"),method:"put",data:t})}function l(e){return Object(s["a"])({url:"task_manager/chanke/task/".concat(e,"/send"),method:"put"})}function o(e,t){return Object(s["a"])({url:"/task_manager/chanke/task/".concat(e,"/close"),method:"put",data:t})}function c(e){return Object(s["a"])({url:"/task_manager/chanke/task/".concat(e,"/preview"),method:"get"})}function u(e){return Object(s["a"])({url:"/task_manager/chanke/task/".concat(e,"/detail"),method:"get"})}function d(e){return Object(s["a"])({url:"/task_manager/chanke/tasks",method:"get",params:e})}function m(e,t){return Object(s["a"])({url:"/task_manager/chanke/task/".concat(e,"/reply_msg"),method:"put",data:t})}},b8d9:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"guidance-container"},[a("el-card",{staticStyle:{"margin-bottom":"30px"}},[a("div",{staticClass:"express-container"},[a("div",{staticClass:"express-item",on:{click:function(t){return e.gotoNewPage("add")}}},[e._v("新建随访任务")]),a("div",{staticClass:"express-item",on:{click:function(t){return e.gotoNewPage("send")}}},[e._v("\n        直接发送随访消息\n      ")])]),a("div",{staticClass:"search-container"},[a("el-row",[a("el-col",{attrs:{span:5}},[a("div",{staticClass:"search-item"},[a("div",[e._v("患者姓名")]),a("div",[a("el-input",{attrs:{placeholder:"请输入患者姓名",size:"mini"},model:{value:e.searchForm.family_member_name,callback:function(t){e.$set(e.searchForm,"family_member_name",t)},expression:"searchForm.family_member_name"}})],1)])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"search-item"},[a("div",[e._v("患者ID")]),a("div",[a("el-input",{attrs:{placeholder:"请输入患者ID",size:"mini"},model:{value:e.searchForm.family_member_id,callback:function(t){e.$set(e.searchForm,"family_member_id",t)},expression:"searchForm.family_member_id"}})],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("用户")]),a("div",[a("el-input",{attrs:{placeholder:"请输入用户昵称或备注名",size:"mini"},model:{value:e.searchForm.user_name,callback:function(t){e.$set(e.searchForm,"user_name",t)},expression:"searchForm.user_name"}})],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item"},[a("div",[e._v("用户ID")]),a("div",[a("el-input",{attrs:{placeholder:"请输入用户ID",size:"mini"},model:{value:e.searchForm.user_id,callback:function(t){e.$set(e.searchForm,"user_id",t)},expression:"searchForm.user_id"}})],1)])])],1),a("el-row",[a("el-col",{attrs:{span:5}},[a("div",{staticClass:"search-item"},[a("div",[e._v("消息任务类型")]),a("div",[a("el-select",{attrs:{size:"mini"},model:{value:e.searchForm.task_message_type,callback:function(t){e.$set(e.searchForm,"task_message_type",t)},expression:"searchForm.task_message_type"}},e._l(e.$store.state.dictionary.chankeFollowType,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)])]),a("el-col",{attrs:{span:5}},[a("div",{staticClass:"search-item"},[a("div",[e._v("完成状态")]),a("div",[a("el-select",{attrs:{size:"mini",disabled:e.statusDisable},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[e._l(e.$store.state.dictionary.chankeFinishStatus,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),a("el-option",{key:"delayed",attrs:{label:"延期",value:"delayed"}})],2)],1)])]),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"search-time search-date-picker"},[a("div",[e._v("\n              任务执行日期\n            ")]),a("div",[a("el-date-picker",{attrs:{size:"mini",type:"daterange","range-separator":"-","start-placeholder":"请选择时间范围起始","end-placeholder":"请选择时间范围结束"},model:{value:e.searchTime,callback:function(t){e.searchTime=t},expression:"searchTime"}})],1)])]),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"search-item search-button margin-left-20"},[a("div",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.search}},[e._v("搜索")])],1),a("div",[a("el-button",{attrs:{size:"mini"},on:{click:e.reset}},[e._v("重置")])],1)])])],1)],1)]),a("el-card",[a("el-tabs",{staticClass:"tab-container",staticStyle:{"padding-right":"20px"},on:{"tab-click":e.handleTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"全部随访",name:"all"}}),a("el-tab-pane",{attrs:{name:"today_un_send"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("div",[e.taskCount.todayListNum>0?a("el-badge",{staticClass:"item",attrs:{value:e.taskCount.todayListNum,max:99}},[e._v("\n              今日待随访任务\n            ")]):a("span",[e._v("今日待随访任务")])],1)])]),a("el-tab-pane",{attrs:{name:"all_un_send"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("div",[e.taskCount.allListNum>0?a("el-badge",{staticClass:"item",attrs:{value:e.taskCount.allListNum,max:99}},[e._v("\n              全部待随访任务\n            ")]):a("span",[e._v("全部待随访任务")])],1)])]),a("el-tab-pane",{attrs:{name:"pending_reply"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("div",[e.taskCount.needToRelayNum>0?a("el-badge",{staticClass:"item",attrs:{value:e.taskCount.needToRelayNum,max:99}},[e._v("\n              留言待回复\n            ")]):a("span",[e._v("留言待回复")])],1)])])],1),a("div",{staticClass:"table-title"},[e._v("\n      产科健康随访消息任务列表\n    ")]),a("task-list",{ref:"taskList",attrs:{"search-form":e.searchForm},on:{closeTask:e.search}})],1)],1)},n=[],r=(a("386d"),a("6762"),a("2fdb"),a("db72")),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{width:"80px",prop:"index",label:"序号"}}),a("el-table-column",{attrs:{prop:"title",width:"260px",label:"标题"}}),a("el-table-column",{attrs:{label:"患者"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",[e._v("\n            "+e._s(t.row.family_member_info&&t.row.family_member_info.name)+"\n            "),t.row.is_replace?a("svg-icon",{attrs:{"icon-class":"replace"}}):e._e()],1),a("div",[e._v("\n            "+e._s(t.row.family_member_info&&t.row.family_member_info.id)+"\n          ")])])]}}])}),a("el-table-column",{attrs:{label:"用户",width:"130px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",{staticStyle:{display:"inline-block"}},[a("el-avatar",{staticStyle:{"vertical-align":"middle"},attrs:{size:"small",src:t.row.user_info.avatar}}),e._v("\n            "+e._s(t.row.user_info.nickname)+"\n          ")],1),a("div",[e._v("\n            "+e._s(t.row.user_info.user_id)+"\n          ")])])]}}])}),a("el-table-column",{attrs:{width:"80px",label:"创建人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.creator_info?t.row.creator_info.name:"系统")+"\n      ")]}}])}),a("el-table-column",{attrs:{prop:"sender",width:"80px",label:"发送人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.sender_info?t.row.sender_info.name:"未知")+"\n      ")]}}])}),a("el-table-column",{attrs:{label:"消息任务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("chankeFollowType")(t.row.task_message_type))+"\n      ")]}}])}),a("el-table-column",{attrs:{prop:"createTime",label:"任务创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatTime")(new Date(t.row.created_at),"{y}-{m}-{d}"))+"\n      ")]}}])}),a("el-table-column",{attrs:{label:"任务执行日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n          "+e._s(e._f("formatTime")(new Date(t.row.executed_at),"{y}-{m}-{d}"))+"\n        ")])]}}])}),a("el-table-column",{attrs:{label:"发送时间",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",["closed"===t.row.status?a("span",[e._v("\n            已关闭\n          ")]):e.taskHasNotSend(t.row.status)?a("span",[e._v("\n            待发送\n          ")]):a("span",[e._v("\n            "+e._s(e._f("formatTime")(new Date(t.row.sended_at)))+"\n          ")])])]}}])}),a("el-table-column",{attrs:{width:"100px",label:"完成状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",[e._v("\n            "+e._s(e._f("chankeFinishStatus")(t.row.status))+"\n          ")]),t.row.delay_day&&t.row.delay_day>0?a("div",{staticStyle:{"font-size":"12px",color:"red"}},[e._v("\n            延期"+e._s(t.row.delay_day)+"天\n          ")]):e._e()])]}}])}),a("el-table-column",{attrs:{width:"180px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("span",[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClick(t.row)}}},[e._v(e._s(e.switchHandleText(t.row.status)))]),e.canBeCanceled(t.row.status)?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.onHandleClose(t.row)}}},[e._v("关闭任务")]):e._e()],1)])]}}])})],1),a("div",{staticStyle:{"margin-top":"10px","text-align":"center"}},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("task-close-dialog",{attrs:{closeDialogVisible:e.closeDialogVisible},on:{closeTask:e.closeTask,closeDialog:function(t){e.closeDialogVisible=!1}}})],1)},l=[],o=a("8aa2"),c=a("7afd"),u=a("2f62"),d={name:"TaskList",props:{searchForm:{type:Object,default:function(){}}},components:{TaskCloseDialog:c["a"]},data:function(){return{closeDialogVisible:!1,currentTaskId:"",closeTaskId:"",currentPage:1,pageSize:10,total:0,tableData:[],loading:!1}},destroyed:function(){this.setTaskCount({})},methods:Object(r["a"])({},Object(u["d"])({setTaskCount:"obstetrics/SET_TASKCOUNT"}),{taskHasNotSend:function(e){return"saved"===e||"pending_send"===e},onHandleClose:function(e){this.currentTaskId=e._id,this.closeDialogVisible=!0},closeTask:function(e){var t=this,a={closed_reason:e.closeReasonType,closed_reason_message:e.closeReason};Object(o["a"])(this.currentTaskId,a).then((function(e){2e4===e.code&&!0===e.data.result&&(t.closeDialogVisible=!1,t.$message.success("关闭任务成功"),t.$emit("closeTask"))}))},canBeCanceled:function(e){return"pending_send"===e||"saved"===e},switchHandleText:function(e){switch(e){case"pending_send":return"去发送";case"pending_reply":return"去回复";case"saved":return"去发送";case"sended":return"查看详情";case"finished":return"查看详情";case"closed":return"查看详情"}},getAllTaskList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.loading=!0;var a=Object(r["a"])({},t,{current_page:this.currentPage,page_size:this.pageSize,task_type:"health_follow",show_replace:1});Object(o["c"])(a).then((function(t){e.loading=!1;var a=t.data;e.tableData=a.list,console.log("this.tableData=",e.tableData),e.total=a.total;var s={allListNum:a.tab_number.all_un_send,needToRelayNum:a.tab_number.pending_reply,todayListNum:a.tab_number.today_un_send};e.setTaskCount(s)}))},handleSizeChange:function(e){this.pageSize=e,this.currentPage=1,this.getAllTaskList(this.searchForm)},handleCurrentChange:function(e){this.currentPage=e,this.getAllTaskList(this.searchForm)},handleClick:function(e){var t={babyId:e.family_member_info._id,taskId:e._id};switch(e.status){case"pending_send":this.$router.push({path:"follow/send",query:t});break;case"pending_reply":this.$router.push({path:"follow/comment",query:t});break;case"saved":this.$router.push({path:"follow/send",query:t});break;case"sended":this.$router.push({path:"follow/detail",query:t});break;case"finished":this.$router.push({path:"follow/detail",query:t});break;case"closed":this.$router.push({path:"follow/close",query:t});break}}})},m=d,h=a("2877"),_=Object(h["a"])(m,i,l,!1,null,null,null),f=_.exports,p={name:"Guidance",components:{TaskList:f},data:function(){return{searchForm:{status:"",family_member_name:"",family_member_id:"",user_name:"",user_id:"",task_message_type:"",executed_at_start:"",executed_at_end:""},statusDisable:!1,searchTime:null,activeName:"all"}},computed:Object(r["a"])({},Object(u["e"])({taskCount:function(e){return e.obstetrics.taskCount}})),watch:{activeName:function(e){"all"!==e?(this.searchForm.status="",this.statusDisable=!0):this.statusDisable=!1}},methods:{resetSearchForm:function(){this.searchForm={status:"",family_member_name:"",family_member_id:"",user_name:"",user_id:"",task_message_type:"",executed_at_start:"",executed_at_end:""}},handleTab:function(){this.$refs.taskList.pageSize=10,this.$refs.taskList.currentPage=1,this.resetSearchForm(),this.searchForm.tab_type=this.activeName,this.$refs.taskList.getAllTaskList(this.searchForm)},search:function(){this.$refs.taskList.pageSize=10,this.$refs.taskList.currentPage=1,this.searchForm.executed_at_start=this.searchTime?this.searchTime[0]:"",this.searchForm.executed_at_end=this.searchTime?this.searchTime[1]:"",this.$refs.taskList.getAllTaskList(this.searchForm)},reset:function(){this.resetSearchForm(),this.searchForm.tab_type=this.activeName,this.searchTime=null,this.$refs.taskList.pageSize=10,this.$refs.taskList.currentPage=1,this.$refs.taskList.getAllTaskList(this.searchForm)},gotoNewPage:function(e){this.$router.push("follow/".concat(e))},needKeepAlive:function(e){var t=["follow/send","follow/detail","follow/comment","follow/add","follow/close"];return t.some((function(t){return e.includes(t)}))},refreshPage:function(){this.activeName="all",this.reset()}},beforeRouteEnter:function(e,t,a){a((function(e){e.needKeepAlive(t.path)?e.search():e.refreshPage()}))}},b=p,v=(a("0106"),a("8702"),Object(h["a"])(b,s,n,!1,null,"13290030",null));t["default"]=v.exports},fbcf:function(e,t,a){}}]);
//# sourceMappingURL=chunk-a9e4c3e2.92b2c12d.js.map