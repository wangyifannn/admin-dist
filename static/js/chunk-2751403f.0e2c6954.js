(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2751403f"],{"4a018":function(t,e,a){},"4b97":function(t,e,a){},"51d2":function(t,e,a){},"720b":function(t,e,a){"use strict";var n=a("d525"),r=a.n(n);r.a},a749:function(t,e,a){"use strict";var n=a("4a018"),r=a.n(n);r.a},a7d9:function(t,e,a){"use strict";var n=a("4b97"),r=a.n(n);r.a},a83b:function(t,e,a){"use strict";var n=a("51d2"),r=a.n(n);r.a},af80:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"coupon-table-list"},[a("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",size:"small"},on:{click:t.gotoAdd}},[t._v("新建优惠券")]),a("div",{staticClass:"coupon-table-list__header"},[a("search-form",{attrs:{"select-opts-maps":t.selectOpts},on:{search:t.handleSearch}})],1),a("div",{staticClass:"coupon-table-list__body"},[a("div",{staticClass:"el-card-warpper coupon-table-list__body__list"},[a("el-card",{staticClass:"el-card--no-shadow el-card--header-nbb el-card--flex"},[a("div",{staticClass:"table-title"},[t._v("优惠券列表")]),a("el-table",{staticClass:"coupon-table-list__body__list__table sbl-table",attrs:{data:t.tableDate}},[a("el-table-column",{attrs:{align:"center",label:"优惠券名称","min-width":"70",prop:"name",fixed:""}}),a("el-table-column",{attrs:{align:"center",label:"优惠形式","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.preferentialForm)+"\n            ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"领取限制","min-width":"70",prop:"limit"}}),a("el-table-column",{attrs:{align:"center",label:"有效期","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(t.getUseRangeText(e.row.valid_day_type,e.row))+"\n            ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"状态","min-width":"60",prop:"status"}}),a("el-table-column",{attrs:{align:"center",label:"使用范围","min-width":"180",prop:"useRange"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.useRange)+"\n            ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"领取情况","min-width":"100",prop:"get_info"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.get_info?e.row.get_info.person_num+"人/已领"+e.row.get_info.discount_num+"张/余"+e.row.get_info.remain_num+"张":"")+"\n            ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"服务单价","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.seePrices(e.row)}}},[t._v("查看详情")])]}}])}),a("el-table-column",{attrs:{align:"center",label:"创建时间","min-width":"70",prop:"createdAt"}}),a("el-table-column",{attrs:{align:"center",label:"创建人","min-width":"60",prop:"createdUser"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(e.row.createdUser.name)+"\n            ")]}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",disabled:t.setBtnDisabled(e.row)},on:{click:function(a){return t.createCode(e)}}},[t._v("生成小程序码")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",disabled:t.setBtnDisabled(e.row)},on:{click:function(a){return t.invalidFun(e.row)}}},[t._v("使失效")])]}}])})],1),a("div",{staticClass:"coupon-table-list__body__list__pagination"},[a("el-pagination",{attrs:{"current-page":t.page.currentPage,"page-sizes":t.pageSizes,"page-size":t.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.page.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)]),a("el-dialog",{attrs:{title:"服务单价详情",visible:t.priceDialogVisible,width:"30%"},on:{"update:visible":function(e){t.priceDialogVisible=e}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.priceList,border:""}},[a("el-table-column",{attrs:{prop:"name",label:"服务名称"}}),a("el-table-column",{attrs:{prop:"price",label:"服务单价"}})],1)],1),a("el-dialog",{class:"提示"===t.dialogTitle?"":"no-title",attrs:{title:t.dialogTitle,visible:t.onlineDialogVisible,"before-close":t.cancelOnlineChangeFun,width:"提示"===t.dialogTitle?"30%":"200px",center:""},on:{"update:visible":function(e){t.onlineDialogVisible=e}}},["提示"===t.dialogTitle?a("span",{staticStyle:{"line-height":"20px"}},[t._v(t._s(t.dialogContent))]):a("span",{staticStyle:{margin:"0 auto",width:"100%","text-align":"center"}},[a("img",{staticStyle:{margin:"0 auto",width:"150px",height:"150px"},attrs:{src:t.codeImg,alt:""}})]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["提示"===t.dialogTitle?a("el-button",{attrs:{type:"primary"},on:{click:t.confirmOffline}},[t._v(t._s(t.dialogConfirmBtnTxt))]):a("el-button",{attrs:{type:"text"},on:{click:t.downLoadImg}},[t._v("下载二维码")])],1)])],1)},r=[],i=(a("28a5"),a("6b54"),a("96cf"),a("3b8d")),o=a("db72"),l=(a("7f7f"),a("ac6a"),a("b7be")),s=a("bc3a"),c=a.n(s),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search"},[a("el-form",{staticClass:"search__form",attrs:{"label-position":"left",model:t.formData}},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:"优惠券名称","label-width":"85px"}},[a("el-input",{attrs:{placeholder:"请输入",size:"small",clearable:""},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"状态","label-width":"45px"}},[a("el-select",{attrs:{placeholder:"请选择",size:"small",clearable:""},model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},t._l(t.selectOptsMaps.allStatus,(function(t){return a("el-option",{key:t.key,attrs:{label:t.value,value:t.key}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"使用范围","label-width":"70px"}},[a("el-select",{attrs:{placeholder:"请选择",size:"small",clearable:""},model:{value:t.formData.use_range_type,callback:function(e){t.$set(t.formData,"use_range_type",e)},expression:"formData.use_range_type"}},t._l(t.selectOptsMaps.useRangeOpt,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1)],1),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"创建人","label-width":"60px"}},[a("el-select",{attrs:{placeholder:"请选择",size:"small",clearable:""},model:{value:t.formData.creator,callback:function(e){t.$set(t.formData,"creator",e)},expression:"formData.creator"}},t._l(t.selectOptsMaps.createUserOpt,(function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})})),1)],1)],1),a("el-col",{staticStyle:{float:"right"},attrs:{span:4}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.handleSearch}},[t._v("搜索")]),a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:t.handleReset}},[t._v("重置")])],1)],1)],1)],1)},d=[],p={name:"",creator:"",use_range_type:"",status:"",currentPage:1,pageSize:10},f={props:{localFormData:{type:Object,default:function(){}},selectOptsMaps:{type:Object,required:!0,default:function(){return{allStatus:[],useRangeOpt:[],createUserOpt:[]}}}},data:function(){return{formData:{}}},created:function(){this.formData=Object.assign({},p,this.localFormData)},methods:{handleSearch:function(){this.$emit("search",{searchParams:this.formData})},handleReset:function(){this.handleResetFormData()},handleResetFormData:function(){this.formData=Object.assign({},p),this.handleSearch()}}},h=f,m=(a("a7d9"),a("720b"),a("2877")),g=Object(m["a"])(h,u,d,!1,null,"010fc33b",null),_=g.exports,b=a("8975"),v=a("5f87"),y={components:{SearchForm:_},data:function(){return{priceList:[],priceDialogVisible:!1,dialogTitle:"提示",dialogConfirmBtnTxt:"确认",dialogContent:"失效后，用户将无法再领取该优惠券。用户之前已经领取成功的优惠券，在有效期内还能继续使用。",onlineDialogVisible:!1,tableDate:[],codeImg:"@/assets/play.png",selectOpts:{allStatus:[],useRangeOpt:[],createUserOpt:[]},page:{total:0,pageSize:10,currentPage:1},activeName:"",is_on_server:!1,pageSizes:[10,20,50],query:{}}},created:function(){this.handleSearch(),this.getFilter()},methods:{createSinglePriceStr:function(t){var e=t.reduce((function(t,e){return"pediatric"===e.department?t+" 儿科：¥"+Object(b["fenToYuan"])(e.price):t+" 产科：¥"+Object(b["fenToYuan"])(e.price)}),"");return e},seePrices:function(t){var e=this,a=[];t.doctor_infos.list.forEach((function(t){a.push({name:t.name,price:e.createSinglePriceStr(t.single_ask_price_info)})}));var n=t.fd_service_types_info.map((function(t){return Object(o["a"])({},t,{price:"¥"+e.fenToYuan(t.price)})}));this.priceList=a.concat(n),this.priceDialogVisible=!0},gotoAdd:function(){this.$router.push({path:"coupon/add"})},couponStatus:b["couponStatus"],fenToYuan:b["fenToYuan"],getCodeImgFun:function(t){var e=this;t.qrcode?this.codeImg=t.qrcode:Object(l["d"])(t._id).then((function(t){e.codeImg=t.data.result?t.data.url:""}))},getUseRangeText:function(t,e){switch(t){case"data_range":return e.valid_day_start+"到"+e.valid_day_end;case"current_day":return"领到券当日开始"+e.valid_duration+"天内有效";case"next_day":return"领到券次日开始"+e.valid_duration+"天内有效";default:return""}},getFilter:function(t){var e=this;Object(l["f"])().then((function(t){var a=t.data;e.selectOpts.allStatus=a.status,e.selectOpts.useRangeOpt=a.use_range_type,e.selectOpts.createUserOpt=a.creator_arr}))},cancelOnlineChangeFun:function(){this.onlineDialogVisible=!1,this.handleSearch()},downLoadImg:function(){var t,e=this,a="https://api-v3.baobaohehu.com/api/";t="/"===a.charAt(a.length-1)?a+"discount_coupon/"+this.activeId+"/download_qrcode":a+"/discount_coupon/"+this.activeId+"/download_qrcode",c.a.get(t,{headers:{Authorization:Object(v["a"])()},responseType:"blob"}).then((function(t){e.codeImg=window.URL.createObjectURL(t.data);var a=t.headers["content-type"],n=new Blob([t.data],{type:a}),r=t.headers.filename||e.activeName;if("undefined"!==typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(n,r);else{var i=window.URL||window.webkitURL,o=i.createObjectURL(n);if(r){var l=document.createElement("a");"undefined"===typeof l.download?window.location=o:(l.href=o,-1!==r.indexOf(".")?l.download="优惠券"+e.activeId:l.download=r,document.body.appendChild(l),l.click(),l.remove())}else window.location=o;e.onlineDialogVisible=!1,e.activeId=""}})).catch((function(t){console.log(t),e.$message.error("系统错误,请稍后重试")}))},invalidFun:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.dialogTitle="提示",this.onlineDialogVisible=!0,this.activeId=e._id;case 3:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}(),setBtnDisabled:function(t){return!(!t||"未开始"===t.status||"生效中"===t.status)},confirmOffline:function(){var t=this,e={_id:this.activeId,status:3};this.activeId&&Object(l["c"])(e).then((function(e){if(e.data.result){t.activeId="",t.onlineDialogVisible=!1;var a=t.dialogConfirmBtnTxt;t.$message({message:e&&e.data.result?a+"成功":a+"失败",type:e&&e.data.result?"success":"error"}),t.handleSearch()}}))},getnum:function(t){var e=t.toString();return e=e.split(".")[1],e},setTableData:function(t){var e=this,a=t.list;this.tableDate=a.map((function(t,a){return{id:t._id?t._id:String(a),_id:t._id?t._id:a,name:t.name,preferentialForm:t.discount_type&&"discount_money"===t.discount_type?"指定金额"+Object(b["fenToYuan"])(t.discount_money)+"元":"指定折扣"+e.getnum(t.discount_rate)+"折",status:e.couponStatus(t.status),limit:t.preson_limit_num&&t.preson_limit_num<=-100?"无限制":"每人"+t.preson_limit_num+"张",useRange:t.use_range_type_value?t.use_range_type_value:"",createdAt:t.created_at?e.formatTime(t.created_at):"-",doctor_infos:t.doctor_infos,fd_service_types_info:t.fd_service_types_info,createdUser:t.creator,get_info:t.get_info,qrcode:t.qrcode?t.qrcode:"",valid_day_type:t.valid_day_type,valid_day_start:e.formatTime(t.valid_day_start,"{y}-{m}-{d}"),valid_day_end:e.formatTime(t.valid_day_end,"{y}-{m}-{d}"),valid_duration:t.valid_duration}}))},setPage:function(t){var e=t.current_page,a=t.page_size,n=t.count;this.page.currentPage=e,this.page.pageSize=a,this.page.total=n},handleSearch:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e&&e.searchParams?e.searchParams:{},a.currentPage||(a.current_page=this.page.currentPage),a.pageSize||(a.page_size=this.page.pageSize),e&&(this.query=a),e||(this.query.current_page=this.page.currentPage,this.query.page_size=this.page.pageSize),t.next=7,Object(l["g"])(this.query);case 7:n=t.sent,r=n.data,this.setPage(Object(o["a"])({},r)),this.setTableData(Object(o["a"])({},r));case 11:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),createCode:function(t){var e=t.row;t.$index;this.dialogTitle="  ",this.activeId=e._id,this.activeName=e.name,this.getCodeImgFun(e),this.onlineDialogVisible=!0},handleCurrentChange:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.page.currentPage=e,t.next=3,this.handleSearch();case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),handleSizeChange:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.page.pageSize=e,t.next=3,this.handleSearch();case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}},w=y,O=(a("a749"),a("a83b"),Object(m["a"])(w,n,r,!1,null,"4bfe90e8",null));e["default"]=O.exports},b7be:function(t,e,a){"use strict";a.d(e,"h",(function(){return r})),a.d(e,"b",(function(){return i})),a.d(e,"i",(function(){return o})),a.d(e,"j",(function(){return l})),a.d(e,"k",(function(){return s})),a.d(e,"g",(function(){return c})),a.d(e,"f",(function(){return u})),a.d(e,"e",(function(){return d})),a.d(e,"a",(function(){return p})),a.d(e,"d",(function(){return f})),a.d(e,"c",(function(){return h}));var n=a("b775");function r(t){return Object(n["a"])({url:"/trade/quanyi",method:"get",params:t})}function i(t){return Object(n["a"])({url:"/trade/quanyi",method:"post",data:t})}function o(t){return Object(n["a"])({url:"/trade/quanyi/".concat(t),method:"get"})}function l(t,e){return Object(n["a"])({url:"/trade/quanyi/".concat(t),method:"put",data:e})}function s(t,e){return Object(n["a"])({url:"/trade/quanyi/".concat(t,"/status"),method:"put",data:e})}function c(t){return Object(n["a"])({url:"/discount_coupon/list",method:"get",params:t})}function u(){return Object(n["a"])({url:"/discount_coupon/filter",method:"get"})}function d(){return Object(n["a"])({url:"/discount_coupon/create_info",method:"get"})}function p(t){return Object(n["a"])({url:"/discount_coupon",method:"post",data:t})}function f(t){return Object(n["a"])({url:"discount_coupon/".concat(t,"/create_qrcode"),method:"put"})}function h(t){return Object(n["a"])({url:"/discount_coupon/"+t._id+"/change_status",method:"put",data:t})}},d525:function(t,e,a){}}]);
//# sourceMappingURL=chunk-2751403f.0e2c6954.js.map