(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e41457da"],{2396:function(e,t,a){},"57e6":function(e,t,a){"use strict";var r=a("2396"),n=a.n(r);n.a},7477:function(e,t,a){"use strict";var r=a("758e"),n=a.n(r);n.a},"758e":function(e,t,a){},"91b6":function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return u}));a("7f7f"),a("386d"),a("28a5");var r=a("db72"),n=(a("96cf"),a("3b8d")),l=a("b775"),i=function(){return Object(l["a"])({url:"/oss/auth",method:"get"})},s=function(e){return Object(l["a"])({url:e+"?x-oss-process=image/info",method:"get"})},c=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var a,n,i,c,o,u,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.oss,n=t.key,i=t.file,c=t.onProgress,o=new FormData,o.append("OSSAccessKeyId",a.OSSAccessKeyId),o.append("success_action_status",200),o.append("policy",a.policy),o.append("Signature",a.Signature),o.append("key",n),o.append("file",i),u="https://pic1.baobaohehu.com/",e.next=11,Object(l["a"])({url:u,method:"post",headers:{"Content-Type":"multipart/form-data"},onUploadProgress:c||null,data:o});case 11:if(u+=n,!(i.type.indexOf("image")>-1)){e.next=18;break}return e.next=15,s(u);case 15:d=e.sent,e.next=27;break;case 18:if(!(i.type.indexOf("video")>-1)){e.next=22;break}d=Object(r["a"])({},i.videoMeta,{size:i.size}),e.next=27;break;case 22:if(!(i.type.indexOf("audio")>-1)){e.next=26;break}d={size:i.size,type:i.type},e.next=27;break;case 26:throw new Error("当前上传的类型不是image或者video；当前上传的类型是"+i.type);case 27:return e.abrupt("return",{url:u,meta:d});case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(e){if(!e||"string"!==typeof e)return!1;var t=e.split("").reverse().join(""),a=t.substring(0,t.search(/\./)).split("").reverse().join("");return a},u=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,a){var r,n,l,s,u,d,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:return r=e.sent,n=r.data,l=Math.floor(99*Math.random())+1,s=(new Date).getTime(),u=o(t.name),s=s+l+"."+u,d="".concat(n.path,"/").concat(n.prefix,"/").concat(s),e.next=11,c({oss:n,key:d,file:t,onProgress:a});case 11:return m=e.sent,e.abrupt("return",m);case 13:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},cded:function(e,t,a){"use strict";a.d(t,"d",(function(){return r})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return i}));a("a481"),a("3b2b"),a("a18c");var r=function(e){switch(e.vaccine_type){case 1:return"减毒";case 2:return"灭活";case 3:return"多糖"}},n=function(e){switch(e.vaccine_class){case 1:return"一类";case 2:return"二类"}},l=function(e){var t=new RegExp("<.+?>","g"),a=e.replace(t,"");return a.length>38?a.slice(0,38)+"...":a},i=[{value:0,label:"待发送"},{value:2,label:"已保存"},{value:3,label:"已发送"},{value:1,label:"留言待回复"},{value:4,label:"已完成"},{value:5,label:"已取消"},{value:6,label:"已关闭"},{value:100,label:"延期"}]},d11d:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"plan-container"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"月龄科普计划",name:"guidance"}}),a("el-tab-pane",{attrs:{label:"疫苗提醒计划",name:"prevention"}})],1),a("task-schedule",{ref:"taskSchedule",attrs:{"schedule-type":"prevention"===e.activeName?2:1}})],1)},n=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"plan-container"},[a("div",[a("el-form",{ref:"taskTimeForm",attrs:{model:e.taskTimeForm,rules:e.taskTimeRules}},[a("div",{staticClass:"plan-time"},[a("div",{staticClass:"plan-time-text"},[a("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("宝宝到达月龄前第\n        ")]),a("div",{staticClass:"time-container"},[a("el-form-item",{attrs:{prop:"createDay"}},[a("el-input",{attrs:{placeholder:"请输入正整数",size:"mini"},model:{value:e.taskTimeForm.createDay,callback:function(t){e.$set(e.taskTimeForm,"createDay",e._n(t))},expression:"taskTimeForm.createDay"}})],1)],1),a("div",{staticClass:"plan-time-text"},[e._v("天，创建任务")])]),a("div",{staticClass:"plan-time"},[a("div",{staticClass:"plan-time-text"},[a("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v("创建任务后第\n        ")]),a("div",{staticClass:"time-container"},[a("el-form-item",{attrs:{prop:"executeDay"}},[a("el-input",{attrs:{placeholder:"请输入正整数",size:"mini"},model:{value:e.taskTimeForm.executeDay,callback:function(t){e.$set(e.taskTimeForm,"executeDay",e._n(t))},expression:"taskTimeForm.executeDay"}})],1)],1),a("div",{staticClass:"plan-time-text"},[e._v("\n          天，为任务执行时间\n        ")])])]),a("div",{staticClass:"table-title"},[a("span",{domProps:{textContent:e._s(1===e.scheduleType?"月龄科普计划":"疫苗提醒计划")}}),a("span",[e._v("任务列表")])]),a("div",{staticClass:"plan-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{height:"350px","empty-text":"请单击下方+添加第一条数据",data:e.tableData,"span-method":e.objectSpanMethod}},[a("el-table-column",{attrs:{label:"任务月龄",align:"center","header-align":"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.year)+"岁"+e._s(t.row.month)+"月"+e._s(t.row.day)+"天\n          ")]}}])}),a("el-table-column",{attrs:{prop:"title",label:"标题",width:"260",align:"center","header-align":"center"}}),2===e.scheduleType?a("el-table-column",{attrs:{prop:"vaccine_name",label:"疫苗名称",align:"center","header-align":"center"}}):e._e(),2===e.scheduleType?a("el-table-column",{attrs:{formatter:e.vaccineClass,prop:"vaccine_type",label:"疫苗种类",align:"center","header-align":"center"}}):e._e(),2===e.scheduleType?a("el-table-column",{attrs:{formatter:e.vaccineType,prop:"vaccine_class",label:"疫苗类型",align:"center","header-align":"center"}}):e._e(),2===e.scheduleType?a("el-table-column",{attrs:{prop:"vaccine_num",label:"接种剂次",align:"center","header-align":"center"}}):e._e(),2===e.scheduleType?a("el-table-column",{attrs:{prop:"vaccine_all",label:"总剂次",align:"center","header-align":"center"}}):e._e(),a("el-table-column",{attrs:{label:"参考知识点",align:"left","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("ellipsis")(t.row.desc,1===e.scheduleType?80:30))+"\n          ")]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticStyle:{"margin-top":"30px","text-align":"center"}},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),a("div",{staticClass:"plan-add"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:function(t){e.formStatus="add",e.dialogVisible=!0}}},[e._v("添加一条任务")])],1)],1),a("div",{staticClass:"submit-button-container"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.upsertTaskSchedule}},[e._v("提交")])],1),a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"600px",center:!0},on:{"update:visible":function(t){e.dialogVisible=t},opened:e.handleDialogOpen}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"label-width":"100px","label-position":"left"}},[a("el-form-item",{attrs:{label:"任务月龄",prop:"year",rules:[{required:!0,message:"请输入任务月龄",trigger:"blur"},{validator:e.checkTaskTime,trigger:"blur"}]}},[a("div",{staticClass:"age-flex-box"},[a("div",{staticClass:"age-container"},[a("el-input",{attrs:{placeholder:"请填写自然数",size:"mini"},model:{value:e.ruleForm.year,callback:function(t){e.$set(e.ruleForm,"year",e._n(t))},expression:"ruleForm.year"}}),e._v("  岁\n          ")],1),a("div",{staticClass:"age-container"},[a("el-input",{ref:"month",attrs:{placeholder:"请填写自然数",size:"mini"},model:{value:e.ruleForm.month,callback:function(t){e.$set(e.ruleForm,"month",e._n(t))},expression:"ruleForm.month"}}),e._v("  月\n          ")],1),a("div",{staticClass:"age-container"},[a("el-input",{ref:"day",attrs:{placeholder:"请填写自然数",size:"mini"},model:{value:e.ruleForm.day,callback:function(t){e.$set(e.ruleForm,"day",e._n(t))},expression:"ruleForm.day"}}),e._v("  天\n          ")],1)])]),a("el-form-item",{attrs:{label:"标题",prop:"title",rules:[{required:!0,message:"请输入标题",trigger:"blur"}]}},[a("el-input",{attrs:{size:"mini",placeholder:"请输入标题",maxlength:"20","show-word-limit":""},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),2===e.scheduleType?a("el-form-item",{attrs:{label:"疫苗名称",prop:"vaccine_name",rules:[{required:!0,message:"请输入疫苗名称",trigger:"blur"}]}},[a("el-input",{attrs:{size:"mini",placeholder:"请输入疫苗名称",maxlength:"20","show-word-limit":""},model:{value:e.ruleForm.vaccine_name,callback:function(t){e.$set(e.ruleForm,"vaccine_name",t)},expression:"ruleForm.vaccine_name"}})],1):e._e(),2===e.scheduleType?a("el-form-item",{attrs:{label:"疫苗种类",prop:"vaccine_class",rules:[{required:!0,message:"请选择疫苗种类",trigger:"change"}]}},[a("el-select",{attrs:{size:"mini"},model:{value:e.ruleForm.vaccine_class,callback:function(t){e.$set(e.ruleForm,"vaccine_class",t)},expression:"ruleForm.vaccine_class"}},e._l(e.vaccineClassOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.scheduleType?a("el-form-item",{attrs:{label:"疫苗类型",prop:"vaccine_type",rules:[{required:!0,message:"请选择疫苗类型",trigger:"change"}]}},[a("el-select",{attrs:{size:"mini"},model:{value:e.ruleForm.vaccine_type,callback:function(t){e.$set(e.ruleForm,"vaccine_type",t)},expression:"ruleForm.vaccine_type"}},e._l(e.vaccineTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.scheduleType?a("el-form-item",{attrs:{label:"接种剂次",prop:"vaccine_num",rules:[{required:!0,message:"请输入正整数",trigger:"blur",type:"number"}]}},[a("div",{staticClass:"vaccine-input"},[a("el-input",{attrs:{size:"mini",placeholder:"请填写正整数"},model:{value:e.ruleForm.vaccine_num,callback:function(t){e.$set(e.ruleForm,"vaccine_num",e._n(t))},expression:"ruleForm.vaccine_num"}})],1)]):e._e(),2===e.scheduleType?a("el-form-item",{attrs:{label:"总剂次",prop:"vaccine_all",rules:[{required:!0,message:"请输入正整数",trigger:"blur",type:"number"}]}},[a("div",{staticClass:"vaccine-input"},[a("el-input",{attrs:{size:"mini",placeholder:"请填写正整数"},model:{value:e.ruleForm.vaccine_all,callback:function(t){e.$set(e.ruleForm,"vaccine_all",e._n(t))},expression:"ruleForm.vaccine_all"}})],1)]):e._e(),a("el-form-item",{attrs:{label:"参考知识点",prop:"desc",rules:[{required:!0,message:"请输入参考知识点",trigger:"blur"}]}},[a("el-input",{staticStyle:{width:"420px"},attrs:{size:"mini",type:"textarea",rows:4,placeholder:"请输入内容",maxlength:"1000","show-word-limit":""},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1),a("el-form-item",[a("uploader-list",{staticClass:"rbd-consult-record__body__editor__image",attrs:{width:"70px",height:"70px",max:3},model:{value:e.ruleForm.icons,callback:function(t){e.$set(e.ruleForm,"icons",t)},expression:"ruleForm.icons"}})],1),a("el-form-item",[a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确认")])],1)])],1)],1)],1)},i=[],s=(a("ac6a"),a("c5f6"),a("2ef0")),c=a.n(s),o=a("cded"),u=a("dc16"),d=a("b775");function m(e,t){return Object(d["a"])({url:"/task_schedule/".concat(e,"/list"),method:"get",params:t})}function p(e,t){return Object(d["a"])({url:"/task_schedule/".concat(e,"/deleteTask/").concat(t),method:"delete"})}function h(e,t){return Object(d["a"])({url:"/task_schedule/".concat(e,"/upsert"),method:"post",data:t})}function v(e,t){return Object(d["a"])({url:"/task_schedule/".concat(e,"/create"),method:"post",data:t})}function f(e,t,a){return Object(d["a"])({url:"/task_schedule/".concat(e,"/updateTask/").concat(t),method:"put",data:a})}var b={components:{UploaderList:u["a"]},props:{scheduleType:{type:Number,default:1}},data:function(){var e=function(e,t,a){setTimeout((function(){t<1?a(new Error("请填写正整数")):a()}),1e3)};return{formStatus:"add",taskTimeRules:{createDay:[{required:!0,message:"请填写正整数",trigger:"blur",type:"number"},{validator:e,trigger:"blur"}],executeDay:[{required:!0,message:"请填写正整数",trigger:"blur",type:"number"}]},taskTimeForm:{createDay:null,executeDay:null},vaccineClassOptions:[{value:1,label:"一类"},{value:2,label:"二类"}],vaccineTypeOptions:[{value:1,label:"减毒"},{value:2,label:"灭活"},{value:3,label:"多糖"}],total:0,currentPage:1,pageSize:10,currentRow:{},dialogVisible:!1,tableData:[],ruleForm:{day:null,month:null,year:null,title:"",desc:"",vaccine_name:"",vaccine_type:null,vaccine_class:null,vaccine_num:null,vaccine_all:null,icons:[]},spanArr:[],position:0,title:""}},watch:{scheduleType:function(e){this.tableData=[],this.getTaskSchedule(e),this.$refs.taskTimeForm.clearValidate(),this.currentPage=1,this.pageSize=10}},mounted:function(){this.getTaskSchedule()},methods:{checkTaskTime:function(e,t,a){var r=this.$refs.month.value,n=this.$refs.day.value,l=/^[0-9]\d*$/;!1!==l.test(t)&&!1!==l.test(r)&&!1!==l.test(n)||a(new Error("请填写全部自然数格式的任务月龄")),r>12&&a(new Error("任务月龄月数不能大于12")),n>31&&a(new Error("任务月龄天数不能大于31")),a()},resetFormDate:function(){this.ruleForm={day:null,month:null,year:null,title:"",desc:"",vaccine_name:"",vaccine_type:null,vaccine_class:null,vaccine_num:null,vaccine_all:null,icons:[]}},handleDialogOpen:function(){var e="";1===this.scheduleType?"add"===this.formStatus?e="添加月龄科普任务":"edit"===this.formStatus&&(e="编辑月龄科普任务"):2===this.scheduleType&&("add"===this.formStatus?e="添加疫苗提醒任务":"edit"===this.formStatus&&(e="编辑疫苗提醒任务")),this.title=e,"add"===this.formStatus&&(this.resetFormDate(),this.$refs.ruleForm.resetFields())},vaccineClass:o["c"],vaccineType:o["d"],handleCurrentChange:function(e){this.currentPage=e,this.getTaskSchedule()},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e,this.getTaskSchedule()},getTaskSchedule:function(){var e=this,t={currentPage:this.currentPage,pageSize:this.pageSize};m(this.scheduleType,t).then((function(t){if(2e4===t.code){var a=t.data;e.tableData=a.list,e.total=a.count,a.task?(e.taskTimeForm.createDay=a.task.create_day,e.taskTimeForm.executeDay=a.task.execute_day):(e.taskTimeForm.createDay="",e.taskTimeForm.executeDay=""),e.rowspan()}}))},upsertTaskSchedule:function(){var e=this;this.$refs.taskTimeForm.validate((function(t){if(!t)return!1;var a={create_day:e.taskTimeForm.createDay,execute_day:e.taskTimeForm.executeDay};h(e.scheduleType,a).then((function(t){2e4===t.code&&e.$message.success("创建任务计划成功")}))}))},rowspan:function(){var e=this;this.spanArr=[],this.tableData.forEach((function(t,a){if(0===a)e.spanArr.push(1),e.position=0;else{var r=""+e.tableData[a].year+e.tableData[a].month+e.tableData[a].day,n=""+e.tableData[a-1].year+e.tableData[a-1].month+e.tableData[a-1].day;r===n?(e.spanArr[e.position]+=1,e.spanArr.push(0)):(e.spanArr.push(1),e.position=a)}}))},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex,a=e.columnIndex;if(2===this.scheduleType&&(0===a||1===a)){var r=this.spanArr[t],n=r>0?1:0;return{rowspan:r,colspan:n}}},handleEdit:function(e){this.currentRow=e,this.ruleForm=c.a.cloneDeep(e),this.formStatus="edit",this.dialogVisible=!0},handleDelete:function(e){var t=this,a="";a=1===this.scheduleType?"删除月龄科普任务":"删除疫苗提醒任务",this.$alert("删除后该条数据将从列表中移除，请确认是否继续删除",a,{confirmButtonText:"删除",cancelButtonText:"放弃删除",center:!0,callback:function(a){"confirm"===a&&p(t.scheduleType,e._id).then((function(e){2e4===e.code&&(t.getTaskSchedule(),t.$message({type:"success",message:"删除成功"}))}))}})},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;delete t.ruleForm._id,"add"===t.formStatus?v(t.scheduleType,t.ruleForm).then((function(e){2e4===e.code&&(t.$message.success("保存成功"),t.dialogVisible=!1,t.getTaskSchedule())})):f(t.scheduleType,t.currentRow._id,t.ruleForm).then((function(e){2e4===e.code&&(t.$message.success("修改成功"),t.dialogVisible=!1,t.getTaskSchedule())}))}))}}},g=b,y=(a("7477"),a("57e6"),a("2877")),_=Object(y["a"])(g,l,i,!1,null,"7eefcfa2",null),k=_.exports,x={name:"Index",components:{TaskSchedule:k},data:function(){return{activeName:"guidance"}}},T=x,F=Object(y["a"])(T,r,n,!1,null,null,null);t["default"]=F.exports}}]);
//# sourceMappingURL=chunk-e41457da.d2796380.js.map