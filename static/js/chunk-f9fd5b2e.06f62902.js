(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f9fd5b2e"],{"07b2":function(e,t,n){},1232:function(e,t,n){},"27ff":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("5c96"),a=function(e){var t=e.data,n=t.result,a=t.message;Object(r["Message"])({type:n?"success":"error",message:a,duration:5e3})}},"284e":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("card",{staticClass:"rbd-consult-record"},[n("div",{staticClass:"rbd-consult-record__title",attrs:{slot:"title"},slot:"title"},[n("span",[e._v(e._s(e.title))]),n("el-button",{attrs:{type:"text"},on:{click:function(t){e.editorIsShow=!e.editorIsShow}}},[e._v("添加备注")])],1),n("div",{staticClass:"rbd-consult-record__body"},[n("el-collapse-transition",[e.editorIsShow?n("div",{staticClass:"rbd-consult-record__body__editor"},[n("el-input",{staticClass:"rbd-consult-record__body__editor__text",attrs:{type:"textarea",rows:5,placeholder:"请输入内容",maxlength:"200","show-word-limit":""},model:{value:e.edittingRecord.text,callback:function(t){e.$set(e.edittingRecord,"text",t)},expression:"edittingRecord.text"}}),n("uploader-list",{staticClass:"rbd-consult-record__body__editor__image",attrs:{width:"70px",height:"70px",max:3},model:{value:e.edittingRecord.image,callback:function(t){e.$set(e.edittingRecord,"image",t)},expression:"edittingRecord.image"}}),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleAddRemark}},[e._v("提交")])],1):e._e()]),n("consult-record",{attrs:{"record-arr":e.orderRecords}})],1)])],1)},a=[],s=(n("96cf"),n("3b8d")),i=(n("c5f6"),n("f8b7")),o=n("27ff"),u=n("dc16"),c=n("12f9"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"record-list"},e._l(e.recordArr,(function(t,r){return n("div",{key:r,staticClass:"record-list__item",class:{"record-list__item--last":r===e.recordArr.length-1}},[n("message",{attrs:{msg:t}})],1)})),0)},l=[],f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"msg-wrapper"},[n("div",{staticClass:"msg"},[n("div",{staticClass:"avatar"},[n("img",{attrs:{src:e.msg.user.avatar}})]),n("div",{staticClass:"body"},[n("div",{staticClass:"info"},[n("div",{staticClass:"name"},[e._v(e._s(e.msg.user.name))]),n("div",{staticClass:"date fontsize-12"},[e._v(e._s(e.formatTime(e.msg.created_at)))])]),n("div",{staticClass:"contents"},e._l(e.msg.remark,(function(t,r){return n("div",{key:""+(Number(new Date)+r),staticClass:"contents__item"},["text"===t.type?n("div",{staticClass:"contents__item--text",domProps:{innerHTML:e._s(e.getText(t.content))}}):e._e(),"image"===t.type?n("div",[n("uploader-list",{staticStyle:{display:"inine-block"},attrs:{uploadList:e.getImageArr,width:"70px",height:"70px",disabled:""}})],1):e._e()])})),0)])])])},m=[],_=(n("a481"),{user:{name:"",avatar:""},remark:[],sendDate:""}),h={components:{UploaderList:u["a"]},props:{msg:{type:Object,default:function(){return _}}},data:function(){return{userRemark:null,read:!1}},computed:{getImageArr:function(){var e=this.msg.remark,t=[];if(e.length){for(var n=0;n<e.length;n++)if("image"===e[n].type)for(var r=0;r<e[n].content.length;r++)t.push(e[n].content[r]);return t}return""}},methods:{getText:function(e){return e.replace("\n","<br>")}}},p=h,b=(n("4d8b"),n("2877")),g=Object(b["a"])(p,f,m,!1,null,"65b12e59",null),v=g.exports,R={components:{Message:v},props:{recordArr:{type:Array,default:function(){return[]}}}},C=R,S=(n("9efd"),Object(b["a"])(C,d,l,!1,null,null,null)),y=S.exports,w={data:function(){return{editorIsShow:!1,edittingRecord:{text:"",image:[]},orderRecords:[]}},props:{updateRemark:{type:Number,default:0},title:{type:String,default:"退款状态及协商历史"},orderId:{type:String,default:""},logicType:{type:String,default:""},orderOrRefundId:{type:String,require:!0,default:""}},components:{Card:c["a"],ConsultRecord:y,UploaderList:u["a"]},watch:{orderOrRefundId:function(){this.getRemarkList()},updateRemark:function(e){console.log("updateRemark===",e),this.getRemarkList()}},created:function(){this.getRemarkList()},methods:{getRemarkList:function(){var e=this;this.orderOrRefundId&&Object(i["m"])({logic_id:this.orderOrRefundId}).then((function(t){e.orderRecords=t.data}))},handleAddRemark:function(){var e=this,t=this.edittingRecord,n=t.text,r=t.image,a=[];if(n&&a.push({type:"text",content:n}),r.length>0&&a.push({type:"image",content:r}),0===a.length)this.$message.warning("添加的备注不能为空！");else{if(!this.orderOrRefundId)return void this.$message.warning("订单或退款id不能为空！");Object(i["b"])({logic_id:this.orderOrRefundId,logic_type:this.logicType,order:this.orderId,remark:a}).then(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return Object(o["a"])(n),e.edittingRecord={text:"",image:[]},e.editorIsShow=!1,t.next=5,e.getRemarkList();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}}},D=w,O=(n("f7ab"),Object(b["a"])(D,r,a,!1,null,null,null));t["a"]=O.exports},"2b14":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"success-manual"},[e._t("default"),n("el-dialog",{staticClass:"success-manual__dialog",attrs:{visible:e.curDialogVisible,"append-to-body":"",width:"420px",top:"25vh"},on:{"update:visible":function(t){e.curDialogVisible=t},closed:e.resetCom}},[n("div",{staticClass:"success-manual__dialog__body"},[n("el-form",{ref:"formData",staticClass:"success-manual__form",attrs:{model:e.formData,rules:e.rules,"label-width":"110px","label-position":"left"}},[n("el-form-item",{attrs:{label:"支付渠道",prop:"payChannel"}},[n("el-input",{attrs:{placeholder:"请填写支付渠道",size:"small",maxlength:"10","show-word-limit":"",clearable:""},model:{value:e.formData.payChannel,callback:function(t){e.$set(e.formData,"payChannel",t)},expression:"formData.payChannel"}})],1),n("el-form-item",{staticClass:"success-manual__form__transfer-amount",attrs:{label:"支付金额",prop:"transferAmount"}},[n("el-input",{staticClass:"success-manual__form__transfer-amount__el-input",attrs:{type:"number",size:"small",placeholder:"请输入转账金额",clearable:""},model:{value:e.formData.transferAmount,callback:function(t){e.$set(e.formData,"transferAmount",e._n(t))},expression:"formData.transferAmount"}})],1),n("el-form-item",{staticClass:"success-manual__form__tsp success-manual__form__item--last",attrs:{label:"转账成功凭证",prop:"transferSuccessProof"}},[n("uploader-list",{attrs:{width:"70px",height:"70px",max:3},model:{value:e.formData.transferSuccessProof,callback:function(t){e.$set(e.formData,"transferSuccessProof",t)},expression:"formData.transferSuccessProof"}})],1)],1)],1),n("span",{staticClass:"success-manual__dialog__footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSubmit}},[e._v("提交")]),n("el-button",{staticClass:"success-manual__dialog__cancel",attrs:{size:"small"},on:{click:function(t){e.curDialogVisible=!1}}},[e._v("取消并返回")])],1)])],2)},a=[],s=n("db72"),i=(n("96cf"),n("3b8d")),o=n("42ce"),u=n("dc16"),c=n("27ff"),d={payChannel:"",transferAmount:"",transferSuccessProof:[]},l={components:{UploaderList:u["a"]},model:{prop:"dialogVisible",event:"change"},props:{id:{type:String,required:!0},dialogVisible:{type:Boolean,default:!1,required:!0}},data:function(){return{curDialogVisible:!1,formData:Object.assign({},d),rules:{payChannel:[{required:!0,message:"请输入支付渠道",trigger:"blur"},{min:0,max:10,message:"长度在 0 到 10 个字符",trigger:"blur"}],transferAmount:[{required:!0,message:"请输入支付金额",trigger:"blur"}],transferSuccessProof:[{required:!0,message:"转账成功凭证不能为空",trigger:"change"}]}}},watch:{dialogVisible:function(e){e!==this.curDialogVisible&&(this.curDialogVisible=e)},curDialogVisible:function(e){this.$emit("change",e)}},methods:{successManualFn:function(e){var t=e.id,n=e.payChannel,r=e.transferAmount,a=e.transferSuccessProof;return new Promise((function(e){var s={pay_channel:n,transfer_amount:r,transfer_success_proof:a.map((function(e){return e.url}))};Object(o["k"])(t,s).then((function(t){Object(c["a"])(t),e()}))}))},handleSubmit:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs["formData"].validate(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n){e.next=5;break}return e.next=3,t.successManualFn(Object(s["a"])({id:t.id},t.formData)).then(Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.curDialogVisible=!1,t.$emit("closedAfter");case 2:case"end":return e.stop()}}),e)}))));case 3:e.next=6;break;case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),resetCom:function(){this.$refs["formData"].resetFields()}}},f=l,m=(n("8744"),n("376d"),n("2877")),_=Object(m["a"])(f,r,a,!1,null,"6d524856",null);t["a"]=_.exports},"312e":function(e,t,n){},3161:function(e,t,n){"use strict";function r(e){switch(e){case"APPLY_PENDING":return"退款申请待处理";case"CLOSED":return"退款已关闭";case"REFUSED":return"退款已被拒绝";case"CONFIRMED":return"退款申请已确认";case"LACK_TRANSFER_CONDITION":return"退款转账条件不足";case"PENDING_TRANSFER_ACCOUNT":return"退款待到账";case"FAIL_TRANSFER_ACCOUNT":return"退款到账失败";case"SUCCESS_MANUAL":return"退款成功(人工)";case"SUCCESS_AUTO":return"退款成功(自动)";default:throw new Error("无法识别的退款状态: ".concat(e))}}function a(e){switch(e){case"misdiagnose":return"误诊";case"user_asked":return"用户要求退款";case"other":return"其它";default:throw new Error("无法识别的退款原因: ".concat(e))}}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}))},3538:function(e,t,n){"use strict";var r=n("c303"),a=n.n(r);a.a},"376d":function(e,t,n){"use strict";var r=n("5355"),a=n.n(r);a.a},"3a02":function(e,t,n){},"3e1a":function(e,t,n){},"42ce":function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"f",(function(){return s})),n.d(t,"h",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"j",(function(){return u})),n.d(t,"e",(function(){return c})),n.d(t,"c",(function(){return d})),n.d(t,"i",(function(){return l})),n.d(t,"k",(function(){return f})),n.d(t,"d",(function(){return m})),n.d(t,"b",(function(){return _}));var r=n("b775");function a(){return Object(r["a"])({url:"/order_refund/filter",method:"get"})}function s(e){return Object(r["a"])({url:"/order_refund/list",method:"post",data:e})}function i(){return Object(r["a"])({url:"/order_refund/process_numbers",method:"get"})}function o(e){return Object(r["a"])({url:"/order_refund/".concat(e,"/agree"),method:"put"})}function u(e,t){return Object(r["a"])({url:"/order_refund/".concat(e,"/refuse"),method:"put",data:t})}function c(e){return Object(r["a"])({url:"/order_refund/".concat(e),method:"get"})}function d(e,t){return Object(r["a"])({url:"/order_refund/".concat(e,"/change_refund_amount"),method:"put",data:t})}function l(e){return Object(r["a"])({url:"/order_refund/".concat(e,"/re_transfer"),method:"get"})}function f(e,t){return Object(r["a"])({url:"/order_refund/".concat(e,"/success_manual"),method:"put",data:t})}function m(e){return Object(r["a"])({url:"/order_refund/batch/check",method:"get",params:e})}function _(e){return Object(r["a"])({url:"/order_refund/batch/agree",method:"put",data:e})}},"457d":function(e,t,n){e.exports={menuText:"#17233D",menuActiveText:"#409EFF",subMenuActiveText:"#17233D",menuBg:"#FEFEFE",menuHover:"#ECF4FF",subMenuBg:"#FEFEFE",subMenuHover:"#ECF4FF",sideBarWidth:"240px"}},"4d8b":function(e,t,n){"use strict";var r=n("3e1a"),a=n.n(r);a.a},5355:function(e,t,n){},"6fbb":function(e,t,n){"use strict";var r=n("ea03"),a=n.n(r);a.a},"796f":function(e,t,n){"use strict";var r=n("457d"),a=n.n(r);a.a},8744:function(e,t,n){"use strict";var r=n("f63f"),a=n.n(r);a.a},"91b6":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return d}));n("7f7f"),n("386d"),n("28a5");var r=n("db72"),a=(n("96cf"),n("3b8d")),s=n("b775"),i=function(){return Object(s["a"])({url:"/oss/auth",method:"get"})},o=function(e){return Object(s["a"])({url:e+"?x-oss-process=image/info",method:"get"})},u=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,a,i,u,c,d,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.oss,a=t.key,i=t.file,u=t.onProgress,c=new FormData,c.append("OSSAccessKeyId",n.OSSAccessKeyId),c.append("success_action_status",200),c.append("policy",n.policy),c.append("Signature",n.Signature),c.append("key",a),c.append("file",i),d="https://pic1.baobaohehu.com/",e.next=11,Object(s["a"])({url:d,method:"post",headers:{"Content-Type":"multipart/form-data"},onUploadProgress:u||null,data:c});case 11:if(d+=a,!(i.type.indexOf("image")>-1)){e.next=18;break}return e.next=15,o(d);case 15:l=e.sent,e.next=27;break;case 18:if(!(i.type.indexOf("video")>-1)){e.next=22;break}l=Object(r["a"])({},i.videoMeta,{size:i.size}),e.next=27;break;case 22:if(!(i.type.indexOf("audio")>-1)){e.next=26;break}l={size:i.size,type:i.type},e.next=27;break;case 26:throw new Error("当前上传的类型不是image或者video；当前上传的类型是"+i.type);case 27:return e.abrupt("return",{url:d,meta:l});case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(e){if(!e||"string"!==typeof e)return!1;var t=e.split("").reverse().join(""),n=t.substring(0,t.search(/\./)).split("").reverse().join("");return n},d=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,s,o,d,l,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:return r=e.sent,a=r.data,s=Math.floor(99*Math.random())+1,o=(new Date).getTime(),d=c(t.name),o=o+s+"."+d,l="".concat(a.path,"/").concat(a.prefix,"/").concat(o),e.next=11,u({oss:a,key:l,file:t,onProgress:n});case 11:return f=e.sent,e.abrupt("return",f);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},"9efd":function(e,t,n){"use strict";var r=n("07b2"),a=n.n(r);a.a},bd7a:function(e,t,n){"use strict";var r=n("1232"),a=n.n(r);a.a},c303:function(e,t,n){},cc3d:function(e,t,n){"use strict";var r=n("312e"),a=n.n(r);a.a},d0a1:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"refund-detail"},[n("div",{staticClass:"refund-detail__status-section"},[n("el-collapse-transition",[e.DICardNoTitleSlot?n("el-steps",{staticClass:"refund-detail__status-section__steps",attrs:{"finish-status":"success",active:e.activeSteps,simple:""}},[n("el-step",{attrs:{title:"用户申请退款"}}),n("el-step",{attrs:{title:"退款申请待处理"}}),n("el-step",{attrs:{title:"退款待到账"}}),n("el-step",{attrs:{title:"退款成功"}})],1):e._e()],1)],1),n("div",{staticClass:"refund-detail__body"},[n("div",{staticClass:"refund-detail__body__dynamic-info"},[n("card",{staticClass:"refund-detail__body__dynamic-info__handler rbd-handler",class:{"rbd-handler--disabled":e.RBDHandlerIsDisabled},attrs:{title:e.detailRefundStatus}},[e.DICardNoTitleSlot?n("div",{staticClass:"rbd-handler__title",attrs:{slot:"title"},slot:"title"},[n("span",{class:"rbd-handler__title--"+("FAIL_TRANSFER_ACCOUNT"!==e.refundStatus?"blue":"red")},[e._v(e._s(e.detailRefundStatus))]),n("count-down",{staticClass:"rbd-handler__count-down",attrs:{"end-date-time":e.applyDateTs},on:{end:e.countDownEnd,change:e.countDownChange},scopedSlots:e._u([{key:"time",fn:function(t){return n("span",{},[n("svg-icon",{attrs:{"icon-class":"miaobiao"}}),e._v("\n              还剩"+e._s(t.days)+"天"+e._s(t.hours)+"小时"+e._s(t.minutes)+"分\n            ")],1)}}],null,!1,3713338837)})],1):e._e(),n("div",{staticClass:"rbd-handler__body"},[n("div",{staticClass:"rbd-handler__body__tips"},[e._v(e._s(e.refundTipsText))]),"APPLY_PENDING"===e.refundStatus?n("div",{staticClass:"rbd-handler__body__btns-desc"},[n("p",[e._v("如果同意，将直接退款给用户")]),n("p",[e._v("如果逾期未处理，将可能引起用户投诉等不良后果")]),n("p",[e._v("如果执行拒绝申请操作，请确保有合理的原因，并记录")])]):e._e(),"APPLY_PENDING"===e.refundStatus?n("div",{staticClass:"rbd-handler__body__btns"},[n("el-button",{staticClass:"rbd-handler__body__btns__item rbd-handler__body__btns__item--first",attrs:{type:e.agreeRefundBtnType,size:"small",loading:e.agreeRefundLoading},on:{click:e.handleAgreeRefund}},[e._v("同意退款")]),n("change-refund-amount",{staticClass:"rbd-handler__body__btns__item",attrs:{id:e.id,"max-amount":e.orderInfo.cost},on:{closedAfter:e.getRefundDetail},model:{value:e.CRefundAmountDialog,callback:function(t){e.CRefundAmountDialog=t},expression:"CRefundAmountDialog"}},[n("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){e.CRefundAmountDialog=!0}}},[e._v("修改退款金额")])],1),n("refuse-refund",{staticClass:"rbd-handler__body__btns__item",attrs:{id:e.id},on:{closedAfter:e.getRefundDetail},model:{value:e.refuseRefundDialog,callback:function(t){e.refuseRefundDialog=t},expression:"refuseRefundDialog"}},[n("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){e.refuseRefundDialog=!0}}},[e._v("拒绝申请")])],1)],1):"LACK_TRANSFER_CONDITION"===e.refundStatus?n("div",{staticClass:"rbd-handler__body__btns"},[n("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.handleReTransfer}},[e._v("申请转账")])],1):"FAIL_TRANSFER_ACCOUNT"===e.refundStatus?n("div",{staticClass:"rbd-handler__body__btns"},[n("success-manual",{attrs:{id:e.id},on:{closedAfter:e.getRefundDetail},model:{value:e.successManualDialog,callback:function(t){e.successManualDialog=t},expression:"successManualDialog"}},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.successManualDialog=!0}}},[e._v("处理成功")])],1)],1):e._e()])]),n("OrderRemark",{attrs:{orderOrRefundId:e.refundInfo.id,updateRemark:e.updateRemark,logicType:"RefundOrder",orderId:e.orderInfo.id}})],1),n("div",{staticClass:"refund-detail__body__static-info"},[n("card",{attrs:{title:"退款详情"}},[n("div",[n("div",{staticClass:"refund-detail__body__static-info__order-name"},[e._v("\n            "+e._s(e.orderInfo.orderName)+"\n          ")]),n("el-form",{staticClass:"refund-detail__body__static-info__order-info",attrs:{inline:!0,model:e.orderInfo}},[n("el-form-item",{attrs:{label:"用户ID:"}},[e._v(e._s(e.orderInfo.userId))]),n("el-form-item",{attrs:{label:"微信昵称:"}},[e._v(e._s(e.orderInfo.userNickName))]),n("el-form-item",{staticClass:"refund-detail__body__static-info__order-info__order-id",attrs:{label:"订单号:"}},[n("span",{staticClass:"cursor-pointer",on:{click:function(t){return e.goOrderDetail(e.orderInfo)}}},[e._v(e._s(e.orderInfo.orderId))])]),n("el-form-item",{attrs:{label:"成交时间:"}},[e._v(e._s(e.orderInfo.payedDate))]),n("el-form-item",{attrs:{label:"单价:"}},[e._v(e._s(e._f("RMBSymbol")(e._f("fenToYuan")(e.orderInfo.unitPrice))))]),n("el-form-item",{attrs:{label:"数量:"}},[e._v(e._s(e.orderInfo.count))]),n("div",[e._v("\n              权益：\n              "),n("span",{staticClass:"detail_value"},[e._v(e._s(e.orderInfo.quanyi_name||"无"))]),e.orderInfo.quanyi_value?n("span",{staticClass:"detail_value"},[e._v("(-"+e._s(e.RMBSymbol(e.orderInfo.quanyi_value))+")")]):e._e()]),n("div",[e._v("\n              优惠券：\n              "),n("span",{staticClass:"detail_value"},[e._v(e._s(e.orderInfo.coupon_name||"无"))]),e.orderInfo.coupon_value?n("span",{staticClass:"detail_value"},[e._v("(-"+e._s(e.RMBSymbol(e.orderInfo.coupon_value))+")")]):e._e()]),n("el-form-item",{attrs:{label:"实际付款:"}},[e._v(e._s(e._f("RMBSymbol")(e._f("fenToYuan")(e.orderInfo.cost))))])],1),n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.refundInfo}},[n("el-form-item",{attrs:{label:"退款号:"}},[e._v(e._s(e.refundInfo.refundId))]),n("el-form-item",{attrs:{label:"退款金额:"}},[e._v(e._s(e._f("RMBSymbol")(e._f("fenToYuan")(e.refundInfo.refundCount))))]),n("el-form-item",{attrs:{label:"退款原因:"}},[e._v(e._s(e.refundInfo.refundReasonValue))]),e.refundInfo.refundOtherReasonDescribe?n("el-form-item",{attrs:{label:"说明:"}},[e._v(e._s(e.refundInfo.refundOtherReasonDescribe))]):e._e()],1)],1)])],1)]),n("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"30%",center:"","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("span",[e._v("该用户如果是续签用户，可能金额有误，请先认真确认退款金额是否正确")]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.confirmRefund}},[e._v("金额无误")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("返回修改")])],1)])],1)},a=[],s=(n("96cf"),n("3b8d")),i=n("42ce"),o=n("12f9"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.endDateTime>=0,expression:"endDateTime >= 0"}],staticClass:"count-down"},[e._t("time",[n("span",{staticClass:"count-down__date"},[e._v(e._s(e.curCountDownStr))])],{days:e.curDays,hours:e.curHours,minutes:e.curMinutes,seconds:e.curSeconds}),e._t("default")],2)},c=[],d=(n("c5f6"),function(e){var t=new Date,n=e-t.getTime();return n=Math.round(n/1e3),n>=0?n:0}),l={props:{endDateTime:{type:Number,required:!0,default:-1},hasBrackets:{type:Boolean,default:!1},isTimer:{type:Boolean,default:!1},totalSeconds:{type:Number,default:0}},data:function(){return{curTotalSeconds:0,curShowTimeSeconds:0,nextShowTimeSeconds:0,timer:null}},computed:{showTimeSeconds:function(){return this.isTimer?this.totalSeconds?this.totalSeconds-this.curShowTimeSeconds:this.curTotalSeconds-this.curShowTimeSeconds:this.curShowTimeSeconds},curDays:function(){return parseInt(this.showTimeSeconds/24/3600)},curHours:function(){return parseInt((this.showTimeSeconds-24*this.curDays*3600)/3600)},curMinutes:function(){return parseInt((this.showTimeSeconds-24*this.curDays*3600-3600*this.curHours)/60)},curSeconds:function(){return this.showTimeSeconds%60},nextSeconds:function(){return this.nextShowTimeSeconds%60},countDownStr:function(){return(this.curMinutes<10?"0"+this.curMinutes:this.curMinutes)+":"+(this.curSeconds<10?"0"+this.curSeconds:this.curSeconds)},curCountDownStr:function(){return this.hasBrackets?"(".concat(this.countDownStr,")"):this.countDownStr}},watch:{endDateTime:{handler:function(e){var t=this;e&&(this.curTotalSeconds=this.curShowTimeSeconds=d(e),this.timer&&clearInterval(this.timer),this.timer=window.setInterval((function(){t.updated()}),50))},immediate:!0},showTimeSeconds:function(e){this.$emit("change",e)}},destroyed:function(){clearInterval(this.timer)},methods:{updated:function(){var e=this;this.nextShowTimeSeconds=d(this.endDateTime),this.nextSeconds!==this.curSeconds&&(this.curShowTimeSeconds=this.nextShowTimeSeconds,0===this.curShowTimeSeconds&&(setTimeout((function(){e.$emit("end")}),500),clearInterval(this.timer)))}}},f=l,m=(n("e478"),n("2877")),_=Object(m["a"])(f,u,c,!1,null,null,null),h=_.exports,p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"refuse-refund"},[e._t("default"),n("el-dialog",{staticClass:"refuse-refund__dialog",attrs:{visible:e.curDialogVisible,"append-to-body":"",width:"410px",top:"25vh"},on:{"update:visible":function(t){e.curDialogVisible=t},closed:e.resetCom}},[n("div",{staticClass:"refuse-refund__dialog__body"},[n("div",{staticClass:"refuse-refund__dialog__body__tips"},[n("i",{staticClass:"el-icon-warning"}),n("span",[e._v("请谨慎操作！请您确认原因后再进行拒绝退款申请的操作！")])]),n("div",{staticClass:"rrd-content"},[n("div",{staticClass:"rrd-content__title"},[e._v("请选择拒绝退款的理由")]),n("el-select",{staticClass:"rrd-content__reason",attrs:{placeholder:"请选择拒绝退款的理由",size:"small"},model:{value:e.refuseReason,callback:function(t){e.refuseReason=t},expression:"refuseReason"}},e._l(e.refuseReasonOpts,(function(e){var t=e.key,r=e.value;return n("el-option",{key:t,attrs:{value:t,label:r}})})),1),"other"===e.refuseReason?n("el-input",{staticClass:"rrd-content__other-reason-des",attrs:{size:"small",rows:1,placeholder:"请填写真实的拒绝原因",maxlength:"10","show-word-limit":""},model:{value:e.refundOtherReasonDescribe,callback:function(t){e.refundOtherReasonDescribe=t},expression:"refundOtherReasonDescribe"}}):e._e()],1),n("div",{staticClass:"refuse-refund__dialog__body__down-tips"},[n("span",[e._v("拒绝退款前，请确保已与用户积极协商，需将协商结果在历史中添加备注信息")])])]),n("span",{staticClass:"refuse-refund__dialog__footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleRefuseRefund}},[e._v("拒绝申请")]),n("el-button",{staticClass:"refuse-refund__dialog__cancel",attrs:{size:"small"},on:{click:function(t){e.curDialogVisible=!1}}},[e._v("取消并返回")])],1)])],2)},b=[],g=n("27ff"),v={model:{prop:"dialogVisible",event:"change"},props:{id:{type:String,required:!0},dialogVisible:{type:Boolean,default:!1,required:!0}},data:function(){return{curDialogVisible:!1,refuseReasonOpts:[{key:"misoperation",value:"用户误操作"},{key:"user_restor",value:"已挽回"},{key:"other",value:"其它"}],refuseReason:"",refundOtherReasonDescribe:""}},watch:{dialogVisible:function(e){e!==this.curDialogVisible&&(this.curDialogVisible=e)},curDialogVisible:function(e){this.$emit("change",e)}},methods:{refuseRefundFn:function(e){var t=e.id,n=e.refuseReasonKey,r=e.refundOtherReasonDescribe,a=void 0===r?"":r,s={refuse_reason:n};return a&&(s.other_reason_message=a),new Promise((function(e){Object(i["j"])(t,s).then((function(t){Object(g["a"])(t),e()}))}))},handleRefuseRefund:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.refuseReason){e.next=3;break}return this.$message({message:"请选择拒绝退款的理由",type:"warning"}),e.abrupt("return");case 3:if("other"!==this.refuseReason||this.refundOtherReasonDescribe){e.next=6;break}return this.$message({message:"拒绝退款的补充说明不能为空",type:"warning"}),e.abrupt("return");case 6:return e.next=8,this.refuseRefundFn({id:this.id,refuseReasonKey:this.refuseReason,refundOtherReasonDescribe:this.refundOtherReasonDescribe}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.curDialogVisible=!1,t.$emit("closedAfter");case 2:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),resetCom:function(){this.refuseReason="",this.refundOtherReasonDescribe=""}}},R=v,C=(n("bd7a"),n("3538"),Object(m["a"])(R,p,b,!1,null,"412035bf",null)),S=C.exports,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"change-refund-amount"},[e._t("default"),n("el-dialog",{staticClass:"change-refund-amount__dialog",attrs:{visible:e.curDialogVisible,"append-to-body":"",width:"420px",top:"25vh"},on:{"update:visible":function(t){e.curDialogVisible=t},closed:e.resetCom}},[n("div",{staticClass:"change-refund-amount__dialog__body"},[n("div",{staticClass:"change-refund-amount__dialog__body__tips"},[n("i",{staticClass:"el-icon-warning"}),n("span",[e._v("请谨慎操作！请您确认原因后再进行修改金额的操作！")])]),n("div",{staticClass:"rrd-content"},[n("div",{staticClass:"rrd-content__reason"},[n("span",[e._v("请填写修改退款金额的理由")]),n("el-input",{staticStyle:{width:"184px"},attrs:{size:"small",maxlength:"10","show-word-limit":""},model:{value:e.changeRefundAmountReason,callback:function(t){e.changeRefundAmountReason=t},expression:"changeRefundAmountReason"}})],1),n("div",{staticClass:"rrd-content__amount"},[n("span",[e._v("请填写该订单要退给用户的最终金额")]),n("el-input",{staticStyle:{width:"96px"},attrs:{type:"number",size:"small",placeholder:"不得高于"+e.maxAmountYuan,clearable:""},model:{value:e.newRefundAmount,callback:function(t){e.newRefundAmount=e._n(t)},expression:"newRefundAmount"}}),n("span",[e._v("元")])],1)]),n("div",{staticClass:"change-refund-amount__dialog__body__down-tips"},[n("span",[e._v("拒绝退款前，请确保已与用户积极协商，需将协商结果在历史中添加备注信息")])])]),n("span",{staticClass:"change-refund-amount__dialog__footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handlechangeRefundAmount}},[e._v("提交修改")]),n("el-button",{staticClass:"change-refund-amount__dialog__cancel",attrs:{size:"small"},on:{click:function(t){e.curDialogVisible=!1}}},[e._v("取消并返回")])],1)])],2)},w=[],D={model:{prop:"dialogVisible",event:"change"},props:{id:{type:String,required:!0},dialogVisible:{type:Boolean,default:!1,required:!0},maxAmount:{type:Number,default:0}},data:function(){return{curDialogVisible:!1,changeRefundAmountReason:"",newRefundAmount:""}},computed:{maxAmountYuan:function(){return parseInt(this.maxAmount/100)}},watch:{dialogVisible:function(e){e!==this.curDialogVisible&&(this.curDialogVisible=e)},curDialogVisible:function(e){this.$emit("change",e)}},methods:{changeRefundAmountFn:function(e){var t=e.id,n=e.newRefundAmount,r=e.changeRefundAmountReason;return new Promise((function(e){Object(i["c"])(t,{refund_amount:n,change_reason:r}).then((function(t){Object(g["a"])(t),e()}))}))},handlechangeRefundAmount:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.changeRefundAmountReason){e.next=3;break}return this.$message({message:"修改退款金额的理由不能为空",type:"warning"}),e.abrupt("return");case 3:if(""!==this.newRefundAmount){e.next=6;break}return this.$message({message:"修改退款金额不能为空",type:"warning"}),e.abrupt("return");case 6:if(!(this.newRefundAmount>this.maxAmountYuan)){e.next=9;break}return this.$message({message:"退款金额不得高于".concat(this.maxAmountYuan),type:"warning"}),e.abrupt("return");case 9:return e.next=11,this.changeRefundAmountFn({id:this.id,changeRefundAmountReason:this.changeRefundAmountReason,newRefundAmount:this.newRefundAmount}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.curDialogVisible=!1,t.$emit("closedAfter");case 2:case"end":return e.stop()}}),e)}))));case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),resetCom:function(){this.newRefundAmount="",this.changeRefundAmountReason=""}}},O=D,A=(n("e37a"),n("6fbb"),Object(m["a"])(O,y,w,!1,null,"cc3f4314",null)),I=A.exports,x=n("2b14"),T=n("284e"),k=n("1315"),N=n("3161"),E=n("8975"),j={id:"",orderName:"",userId:"",userNickName:"",orderId:"",payedDate:"",unitPrice:0,count:0,cost:0,rights:"家庭医生用户问诊半价",coupon:"5元优惠券"},F={refundId:"",refundCount:0,refundReasonValue:"",refundOtherReasonDescribe:"",refuseReasonValue:"",refuseOtherReasonDescribe:""},L={components:{OrderRemark:T["a"],Card:o["a"],CountDown:h,RefuseRefund:S,ChangeRefundAmount:I,SuccessManual:x["a"]},filters:{statusDescription:function(e,t){switch(e){case"PENDING":return"用户已下单，等待支付";case"SUCCESS":return"交易已成功，如果用户提出售后要求，请积极用户与协商，做好售后服务。";case"CLOSED":return"取消原因：".concat(t);default:if(e)throw new Error("无法识别的订单状态: ".concat(e));return""}}},data:function(){return{dialogVisible:!1,allRefundStatus:["APPLY_PENDING","CLOSED","REFUSED","LACK_TRANSFER_CONDITION","PENDING_TRANSFER_ACCOUNT","FAIL_TRANSFER_ACCOUNT","SUCCESS_MANUAL","SUCCESS_AUTO"],refundStatus:"APPLY_PENDING",updateRemark:"",orderInfo:Object.assign({},j),refundInfo:Object.assign({},F),refundRecords:[],agreeRefundLoading:!1,applyDateTs:0,refundTimeInterval:"normal",refuseRefundDialog:!1,CRefundAmountDialog:!1,successManualDialog:!1,editorIsShow:!1,edittingRecord:{text:"",image:[]}}},computed:{activeSteps:function(){switch(this.refundStatus){case"APPLY_PENDING":case"LACK_TRANSFER_CONDITION":return 2;case"PENDING_TRANSFER_ACCOUNT":case"FAIL_TRANSFER_ACCOUNT":return 3;case"SUCCESS_MANUAL":case"SUCCESS_AUTO":return 4;default:return 1}},RBDHandlerIsDisabled:function(){return-1===["APPLY_PENDING","LACK_TRANSFER_CONDITION","FAIL_TRANSFER_ACCOUNT"].indexOf(this.refundStatus)},DICardNoTitleSlot:function(){return-1===["CLOSED","REFUSED","SUCCESS_AUTO","SUCCESS_MANUAL","CONFIRMED"].indexOf(this.refundStatus)},detailRefundStatus:function(){switch(this.refundStatus){case"APPLY_PENDING":return"请处理退款申请";case"CLOSED":return"退款已关闭";case"REFUSED":return"退款已被拒绝";case"LACK_TRANSFER_CONDITION":return"转账申请失败";case"PENDING_TRANSFER_ACCOUNT":return"请耐心等待退款到账";case"FAIL_TRANSFER_ACCOUNT":return"退款到账失败";case"SUCCESS_MANUAL":return"退款成功";case"CONFIRMED":return"退款申请已确认";case"SUCCESS_AUTO":return"退款成功";default:throw new Error("退款详情页面----无法识别的退款状态: ".concat(this.refundStatus))}},refundTipsText:function(){var e="拒绝理由：".concat(this.refundInfo.refuseReasonValue);switch(this.refundInfo.refuseOtherReasonDescribe&&(e+="，".concat(this.refundInfo.refuseOtherReasonDescribe)),this.refundStatus){case"APPLY_PENDING":return"请及时联系用户协商退款事宜";case"CLOSED":return"";case"REFUSED":return e;case"CONFIRMED":return"退款申请已确认";case"LACK_TRANSFER_CONDITION":return"请及时联系财务，确认转账条件不满足的原因，处理后再次发起转账申请";case"PENDING_TRANSFER_ACCOUNT":return"金额已经在原路返回用户账户当中，具体到账时间已微信到账规则为准。";case"FAIL_TRANSFER_ACCOUNT":return"请确认退款到账失败原因后，联系财务人工转账到用户指定账户";case"SUCCESS_MANUAL":return"";case"SUCCESS_AUTO":return"";default:throw new Error("无法识别的退款状态: ".concat(this.refundStatus,",--退款提示语错误显示--"))}},id:function(){return this.$route.params.id},agreeRefundBtnType:function(){switch(this.refundTimeInterval){case"normal":return"primary";case"warning":return"warning";case"overtime":return"danger";default:throw new Error("无法识别的退款时段: ".concat(this.refundTimeInterval,",--同意退款按钮为默认按钮--"))}}},created:function(){this.getRefundDetail()},methods:{RMBSymbol:E["RMBSymbol"],fenToYuan:E["fenToYuan"],goOrderDetail:function(e){this.$router.push({name:"OrderDetail",params:{id:e.id}})},refundStatusFilter:N["b"],getRefundDetail:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.updateRemark=(new Date).getTime(),console.log("this.updateRemark===",this.updateRemark),e.next=4,Object(i["e"])(this.id);case 4:t=e.sent,n=t.data,r=n.order,a=n.order_refund,s=n.refund_records,this.applyDateTs=k["DateTime"].fromISO(a.apply_at).plus({days:7}).ts,this.refundStatus=n.refund_status,this.orderInfo=Object.assign(this.orderInfo,{id:r._id,orderName:r.order_name,userId:r.user.user_id,userNickName:r.user.nickname,orderId:r.order_id,payedDate:k["DateTime"].fromISO(r.payed_at).toFormat("yyyy-LL-dd"),unitPrice:r.unit_price,count:r.count,cost:r.pay_price,quanyi_value:r.quanyi_value,coupon_value:r.coupon_value,rights:r.fd_right?r.fd_right:"无",coupon_name:r.coupon_name?r.coupon_name:"无",quanyi_name:r.quanyi_name?r.quanyi_name:"无"}),this.refundInfo=Object.assign(this.refundInfo,{id:a._id,refundId:a.refund_id,refundCount:a.refund_amount,refundReasonValue:a.refund_reason.value,refundOtherReasonDescribe:a.refund_reason.other_desc,refuseReasonValue:a.refuse_reason&&a.refuse_reason.value||"",refuseOtherReasonDescribe:a.refuse_reason&&a.refuse_reason.other_desc||""}),this.refundRecords=s.map((function(e){var t=e.user,n=e.remark;return{user:t,remark:n.map((function(e){return"image"===e.type&&(e.content=e.content.map((function(e){return{type:"image",url:e}}))),e})),sendDate:e.created_at}}));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),countDownChange:function(e){var t=k["Duration"].fromObject({days:2,hours:23,minutes:59,seconds:59}).valueOf()/1e3;this.refundTimeInterval=e>t?"normal":e<=t&&e>0?"warning":"overtime"},countDownEnd:function(){var e=this;setTimeout(Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getRefundDetail();case 2:case"end":return t.stop()}}),t)}))),1e3)},handleClose:function(){this.dialogVisible=!1},handleAgreeRefund:function(){var e=new Date("2019-10.29"),t=new Date(this.orderInfo.payedDate);t<e?this.dialogVisible=!0:this.confirmRefund()},confirmRefund:function(){var e=this;this.agreeRefundLoading=!0,Object(i["a"])(this.id).then(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return Object(g["a"])(n),t.next=3,e.getRefundDetail();case 3:e.agreeRefundLoading=!1,e.dialogVisible=!1,e.updateRemark=(new Date).getTime();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(){e.agreeRefundLoading=!1,e.dialogVisible=!1}))},handleReTransfer:function(){var e=this;Object(i["i"])(this.id).then(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return Object(g["a"])(n),t.next=3,e.getRefundDetail();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}},P=L,U=(n("796f"),n("cc3d"),Object(m["a"])(P,r,a,!1,null,"025435c5",null));t["default"]=U.exports},e37a:function(e,t,n){"use strict";var r=n("ed3e"),a=n.n(r);a.a},e478:function(e,t,n){"use strict";var r=n("f5c4"),a=n.n(r);a.a},ea03:function(e,t,n){},ed3e:function(e,t,n){},f5c4:function(e,t,n){},f63f:function(e,t,n){},f7ab:function(e,t,n){"use strict";var r=n("3a02"),a=n.n(r);a.a},f8b7:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"i",(function(){return s})),n.d(t,"h",(function(){return i})),n.d(t,"k",(function(){return o})),n.d(t,"l",(function(){return u})),n.d(t,"d",(function(){return c})),n.d(t,"f",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"j",(function(){return f})),n.d(t,"g",(function(){return m})),n.d(t,"c",(function(){return _})),n.d(t,"m",(function(){return h})),n.d(t,"b",(function(){return p}));var r=n("b775");function a(e){return Object(r["a"])({url:"/fd/contract/".concat(e,"/active"),method:"put"})}function s(){return Object(r["a"])({url:"order/basic/options",method:"get"})}function i(){return Object(r["a"])({url:"/order/basic/order_name/options",method:"get"})}function o(){return Object(r["a"])({url:"/order/basic/order_status/options",method:"get"})}function u(){return Object(r["a"])({url:"/order/basic/order_type/options",method:"get"})}function c(e){return Object(r["a"])({url:"/order/check_export",method:"post",data:e})}function d(e){return Object(r["a"])({url:"/order/".concat(e,"/detail"),method:"get"})}function l(e,t){return Object(r["a"])({url:"/order/".concat(e,"/close"),method:"put",data:t})}function f(){return Object(r["a"])({url:"/order/process_numbers",method:"get"})}function m(e){return Object(r["a"])({url:"/order/list",method:"post",data:e})}function _(e,t){return Object(r["a"])({url:"/order/".concat(e,"/refund"),method:"put",data:t})}function h(e){return Object(r["a"])({url:"/order/log",method:"get",params:e})}function p(e){return Object(r["a"])({url:"/order/log",method:"post",data:e})}}}]);
//# sourceMappingURL=chunk-f9fd5b2e.06f62902.js.map