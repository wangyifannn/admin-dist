(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-421431b4"],{"0703":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"login"},[n("div",{staticClass:"login__wrapper"},[n("div",{staticClass:"login__icon-people"}),n("div",{staticClass:"login__container"},[n("el-tabs",{staticClass:"login__el-tabs",attrs:{stretch:""},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[t.showLoginUserId?n("el-tab-pane",{attrs:{label:"成员ID登录",name:"third"}},[n("div",{staticClass:"login__el-tabs__item-container",attrs:{id:"login_user_id_container"}},[n("el-form",{ref:"form",staticClass:"user-id-login-form",attrs:{model:t.userInfo,"label-width":"55px"}},[n("el-form-item",{attrs:{label:"成员ID"}},[n("el-input",{attrs:{placeholder:"请输入成员ID"},model:{value:t.userInfo.userId,callback:function(e){t.$set(t.userInfo,"userId",e)},expression:"userInfo.userId"}})],1),n("el-form-item",[n("el-button",{staticClass:"align-center",attrs:{type:"primary",id:"login-user-id-btn"},on:{click:t.onSubmitLogin}},[t._v("\n                  确认登录\n                ")])],1)],1)],1)]):t._e(),n("el-tab-pane",{attrs:{label:"扫码登录",name:"first"}},[n("div",{staticClass:"login__el-tabs__item-container",attrs:{id:"login_qr_container"}})]),n("el-tab-pane",{attrs:{label:"账号登录",name:"second"}},[n("div",{staticClass:"login__el-tabs__item-container",attrs:{id:"login_password_container"}})])],1)],1)])])},i=[],r=(n("a481"),n("b893"));function a(t){var e,n=document.createElement("iframe"),o=("qr"===t.type?"https://login.dingtalk.com/login/qrcode.htm?goto=":"https://login.dingtalk.com/login/index.htm?goto=")+t.goto;o+=t.style?"&style="+encodeURIComponent(t.style):"",o+=t.href?"&href="+t.href:"",n.src=o,n.frameBorder="0",n.allowTransparency="true",n.scrolling="no",n.width=t.width?t.width+"px":"365px",n.height=t.height?t.height+"px":"400px",e=document.getElementById(t.id),e.innerHTML="",e.appendChild(n)}var s=n("c24f"),c=n("5f87");function d(){var t=Object(c["a"])()||"";return t.replace("Bearer ","")}var l={name:"DingDing",data:function(){return{activeName:"first",showLoginUserId:!1,userInfo:{userId:""},hanndleMessage:function(){},url:""}},created:function(){var t=this;Object(s["c"])().then((function(e){var n=e.data,o=n.appid,i=n.redirect_uri;t.APPID=o,t.url=encodeURIComponent("".concat(i,"?redirect=").concat(t.$route.query.redirect)),t.initLoginQrContainer()}))},mounted:function(){var t=window.location.host;"oa.baobaohehu.com"!==t&&(this.showLoginUserId=!0,this.activeName="third");var e=this;this.hanndleMessage=function(t){var n=t.origin;if("https://login.dingtalk.com"===n){var o=t.data,i="https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=".concat(e.APPID,"&response_type=code&scope=snsapi_login&state=STATE&redirect_uri=").concat(e.url,"&loginTmpCode=").concat(o),r=document.querySelector("#login_qr_container iframe");r.src=i}t.data.code&&e.handlerCodeLogin(t.data)},Object(r["b"])(window,"message",this.hanndleMessage)},beforeDestroy:function(){Object(r["a"])(window,"message",this.hanndleMessage)},methods:{thirdpartyLogin:function(){if(console.log("thirdpartyLogin"),this.$route.query&&this.$route.query.model_url){console.log("thirdpartyLogin - 1");var t=this.$route.query.model_url,e=this.$route.query.model_redirect||"/";return window.location.replace("".concat(t,"?_token=").concat(d(),"&redirect_url=").concat(e)),!0}return console.log("thirdpartyLogin - 2"),!1},onSubmitLogin:function(){var t=this;this.userInfo.userId?this.$store.dispatch("user/setForeverToken",this.userInfo.userId).then((function(e){e.token&&(t.thirdpartyLogin()||t.$router.push({path:"/"}))})):this.$message({type:"warning",message:"用户ID不能为空，请输入用户ID"})},handleClick:function(t,e){document.querySelector("#login_password_container")&&!document.querySelector("#login_password_container iframe")&&this.initLoginPasswordContainer()},initLoginPasswordContainer:function(){var t=encodeURIComponent("https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=".concat(this.APPID,"&response_type=code&scope=snsapi_login&state=password&redirect_uri=").concat(this.url));a({id:"login_password_container",goto:t,style:"border:none;background-color:#FFFFFF;",width:"400",height:"400"})},initLoginQrContainer:function(){var t=encodeURIComponent("https://oapi.dingtalk.com/connect/oauth2/sns_authorize?appid=".concat(this.APPID,"&response_type=code&scope=snsapi_login&state=qrcode&redirect_uri=").concat(this.url));a({id:"login_qr_container",goto:t,style:"border:none;background-color:#FFFFFF;",width:"400",height:"400",type:"qr"})},handlerCodeLogin:function(t){var e=this,n=this;return new Promise((function(o,i){t.code&&e.$store.dispatch("user/login",{code:t.code}).then((function(){e.thirdpartyLogin()||(n.$router.push(t.redirect||"/"),o())})).catch((function(){n.initLoginQrContainer(),n.initLoginPasswordContainer()}))}))}}},u=l,h=(n("9ffa"),n("c744"),n("2877")),g=Object(h["a"])(u,o,i,!1,null,"61e1e271",null);e["default"]=g.exports},"506a":function(t,e,n){},"9ffa":function(t,e,n){"use strict";var o=n("506a"),i=n.n(o);i.a},b893:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return i}));var o=function(){return document.addEventListener?function(t,e,n){t&&e&&n&&t.addEventListener(e,n,!1)}:function(t,e,n){t&&e&&n&&t.attachEvent("on"+e,n)}}(),i=function(){return document.removeEventListener?function(t,e,n){t&&e&&t.removeEventListener(e,n,!1)}:function(t,e,n){t&&e&&t.detachEvent("on"+e,n)}}()},be95:function(t,e,n){},c744:function(t,e,n){"use strict";var o=n("be95"),i=n.n(o);i.a}}]);
//# sourceMappingURL=chunk-421431b4.8edcd3e2.js.map