(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0215a714"],{"06d2":function(e,t,a){},3681:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a("db72");a("ac6a");function n(e){var t=["一","二","三","四","五","六","七","八","九","十"],a="";e=""+e;for(var i=0;i<e.length;i++)a+=t[parseInt(e.charAt(i))];return 2===a.length&&(a.charAt(1)===t[0]?(a=a.charAt(0)+t[10],a===t[1]+t[10]&&(a=t[10])):a.charAt(0)===t[1]&&(a=t[10]+a.charAt(1))),a}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=[],o=function(e){switch(e){case 1:return n;case 2:return function(e){return 1+e};case 3:return function(e){return a+1+"."+(1+e)};default:throw new Error("超过3级")}}(t);return e.forEach((function(e,a){var n=JSON.parse(JSON.stringify(e));delete n.children;var d=Object(i["a"])({},e,{ptitle:o(a)+" "+e.title});e.children&&e.children.length>0&&(d.children=r(e.children,t+1,a)),s.push(d)})),s}},4002:function(e,t,a){"use strict";var i=a("52483"),n=a.n(i);n.a},52483:function(e,t,a){},"7cdf":function(e,t,a){var i=a("5ca1");i(i.S,"Number",{isInteger:a("9c12")})},"9c12":function(e,t,a){var i=a("d3f4"),n=Math.floor;e.exports=function(e){return!i(e)&&isFinite(e)&&n(e)===e}},db89:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"add-plan-box",staticClass:"add-plan-box"},[a("div",{staticClass:"title"},[e._v(e._s(e.haddleType)+"计划")]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isConfirm,expression:"!isConfirm"}],staticClass:"el-steps-box"},[a("el-steps",{attrs:{active:e.active,"align-center":"",space:"38%","process-status":"process"}},[a("el-step",{staticClass:"baseInfo",attrs:{title:"计划基本信息"},nativeOn:{click:function(t){return e.switchFirstStep(t)}}}),a("el-step",{attrs:{title:"计划内容信息"},nativeOn:{click:function(t){return e.switchSecondStep(t)}}})],1)],1),a("div",{staticClass:"step-content",class:e.isConfirm?"complete-plan":""},[0===e.active?a("div",{staticClass:"step1-content"},[a("el-form",{ref:"formData",staticStyle:{margin:"0 auto",width:"540px"},attrs:{model:e.formData,rules:e.rules,"label-width":"82px"}},[a("el-form-item",{attrs:{label:"计划名称",prop:"name"}},[a("el-input",{attrs:{disabled:e.disabled,type:"text",placeholder:"请输入计划名称",maxlength:"10","show-word-limit":""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"制定人",required:""}},[a("el-input",{attrs:{type:"text",disabled:"",placeholder:"制定人名称取自钉钉登录名"},model:{value:e.makeName,callback:function(t){e.makeName=t},expression:"makeName"}})],1),a("el-form-item",{attrs:{label:"阶段数",prop:"stage_number"}},[a("el-select",{attrs:{disabled:e.intervalNumberdisabled,clearable:"",placeholder:"请选择阶段数"},on:{change:e.intervalChange},model:{value:e.formData.stage_number,callback:function(t){e.$set(e.formData,"stage_number",t)},expression:"formData.stage_number"}},e._l(e.NumArr(6),(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"轮岗位置",prop:"job_rotation_position"}},[a("el-select",{attrs:{disabled:e.disabled,clearable:"",placeholder:"请选择阶段数"},model:{value:e.formData.job_rotation_position,callback:function(t){e.$set(e.formData,"job_rotation_position",t)},expression:"formData.job_rotation_position"}},e._l(e.NumArr(e.formData.stage_number||0),(function(t){return a("el-option",{key:t,attrs:{label:e.chnNumChar(t),value:t}})})),1)],1),a("el-form-item",{attrs:{label:"轮岗天数",prop:"job_rotation_day"}},[a("el-input",{attrs:{disabled:e.disabled,placeholder:"请输入阿拉伯数字，如：1，2…"},model:{value:e.formData.job_rotation_day,callback:function(t){e.$set(e.formData,"job_rotation_day",e._n(t))},expression:"formData.job_rotation_day"}})],1),a("el-form-item",{attrs:{label:"试岗天数",prop:"job_test_day"}},[a("el-input",{attrs:{disabled:e.disabled,placeholder:"请输入阿拉伯数字，如：1，2…"},model:{value:e.formData.job_test_day,callback:function(t){e.$set(e.formData,"job_test_day",e._n(t))},expression:"formData.job_test_day"}})],1),e.intervalNum>0?a("el-form-item",{staticClass:"learningNumber",attrs:{label:"各阶段每天学习节数",required:""}},e._l(e.intervalNum,(function(t,i){return a("el-col",{key:i,staticClass:"el-col-marginLeft",attrs:{span:6}},[a("el-form-item",{attrs:{rules:{required:!0,type:"number",message:"各阶段每天学习节数不能为空",trigger:"blur"}}},[a("el-input",{attrs:{type:"number",disabled:e.disabled,placeholder:"请输入数字"},model:{value:e.formData.stage_study_number[i],callback:function(t){e.$set(e.formData.stage_study_number,i,t)},expression:"formData.stage_study_number[intervalIndex]"}}),a("div",{staticClass:"tips"},[e._v("\n                第"+e._s(e.chnNumChar(i+1))+"阶段\n              ")])],1)],1)})),1):e._e()],1),a("div",{staticClass:"button"},[a("el-button",{attrs:{type:"primary",size:"small"},nativeOn:{click:function(t){return e.nextStep("formData")}}},[e._v("下一步")])],1)],1):e._e(),1===e.active?a("div",{staticClass:"step2-content"},[a("el-tree",{key:e.treeKey,ref:"step2-tree",staticClass:"el-tree-box",attrs:{data:e.frameAdminData,"node-key":"id",props:e.defaultProps,"default-expand-all":"","empty-text":"暂无内容，请重新输入关键词查询"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,n=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(i.label))]),e.isConfirm||e.disabled?e._e():a("span",{staticClass:"handle-btns"},["third"!==n.type&&"轮岗"!==n.title?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handleAdd(t,i,n)}}},[e._v("\n              添加\n            ")]):e._e(),"first"!==n.type&&"轮岗"!==n.title?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.haddleEdit(t,i,n)}}},[e._v("\n              编辑\n            ")]):e._e(),"first"!==n.type&&"轮岗"!==n.title?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.remove(t,i,n)}}},[e._v("\n              删除\n            ")]):e._e()],1)])}}],null,!1,3612852256)}),a("div",{staticClass:"create-plan"},[e.isConfirm||e.disabled?e._e():a("el-button",{staticClass:"create-plan-btn",attrs:{type:"primary"},on:{click:e.haddleCreatePlan}},[e._v("生成计划")]),e.isConfirm?a("div",{staticClass:"confirm-create-plan"},[a("el-button",{staticClass:"create-plan-btn",on:{click:e.haddleCancel}},[e._v("取消")]),a("el-button",{staticClass:"create-plan-btn",attrs:{type:"primary"},on:{click:e.haddleConfirm}},[e._v("确定")])],1):e._e()],1)],1):e._e(),a("el-dialog",{attrs:{visible:e.showDialog,center:"",width:"30%",top:"25vh"},on:{"update:visible":function(t){e.showDialog=t}}},[a("div",{ref:"frame_tree-dialog",staticClass:"frame_tree-dialog"},[a("div",{staticStyle:{color:"#fff"},on:{click:function(t){e.showDialog=!1}}},[e._v("X")]),a("el-tree",{staticClass:"frame_tree-dialog__tree disable",attrs:{data:e.BaseframeAdminData,props:e.defaultProps,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,"check-on-click-node":!1,"empty-text":"暂无内容"},on:{"node-click":e.handleSelectTreeNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node;return a("span",{staticClass:"custom-base-tree-node",class:i.disabled?"nodeDisabled":""},[a("span",[e._v(e._s(i.label))])])}}])})],1)])],1)])},n=[],r=(a("20d6"),a("ac4d"),a("8a81"),a("ac6a"),a("75fc")),s=(a("7f7f"),a("96cf"),a("3b8d")),o=a("db72"),d=(a("c5f6"),a("7cdf"),a("2b0e")),c=a("2f62"),l=a("f296"),u=a("ed08"),f=a("3681"),h=d["default"].filter("chnNumChar");function m(e,t){return Array.apply(null,{length:e+1}).reduce((function(e,a,i){var n={id:i+1,type:"first"};return i===t?n.title="轮岗":(i=i>t?i-1:i,n.title="第".concat(h(i+1),"阶段")),e.push(n),e}),[])}function p(e){return Array.apply(null,{length:e}).reduce((function(e,t,a){return e.concat(a+1)}),[])}var b={data:function(){var e=function(e,t,a){""===t?a(new Error("您输入的内容有误，请重新输入")):t<=0?a(new Error("请输入大于0的数字")):Number.isInteger(t)?a():a(new Error("您输入的内容有误，请重新输入"))};return{active:0,intervalNum:0,treeKey:0,showDialog:!1,isEdit:!1,disabled:!1,formData:{name:"",stage_number:"",job_rotation_position:"",job_rotation_day:"",job_test_day:"",stage_study_number:[]},BaseframeAdminData:[],copyBaseInfo:[],rules:{name:[{required:!0,message:"您输入的内容有误，请重新输入",trigger:"blur"}],stage_number:[{required:!0,message:"您输入的内容有误，请重新输入",trigger:"change"}],job_rotation_position:[{required:!0,message:"您输入的内容有误，请重新输入",trigger:"change"}],job_rotation_day:[{validator:e,trigger:"blur"}],job_test_day:[{validator:e,trigger:"blur"}]},frameAdminData:[],defaultProps:{children:"children",label:"ptitle"},isConfirm:!1,pos:{x:0,y:0},planListId:"",haddleType:"添加",arrNum:["一","二","三","四","五","六","七","八","九","十"],makeName:"",intervalNumberdisabled:!1,addIndex:0}},computed:Object(o["a"])({},Object(c["c"])(["name"])),created:function(){"查看"===this.$route.query.haddleType?(this.intervalNumberdisabled=!0,this.disabled=!0):(this.disabled=!1,this.intervalNumberdisabled=!0),"添加"===this.$route.query.haddleType&&(this.intervalNumberdisabled=!1),this.haddleType=this.$route.query.haddleType,this.planListId=this.$route.query.id,this.getSinglePlan()},mounted:function(){},methods:{intervalChange:function(e){this.formData.stage_study_number.length&&(this.formData.stage_study_number=this.formData.stage_study_number.slice(0,e-1)),this.intervalNum=e},getSinglePlan:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.planListId){e.next=11;break}return t={id:this.planListId},e.next=4,Object(l["O"])(t);case 4:a=e.sent,this.formData=a.data,this.frameAdminData=Object(f["a"])(a.data.stage_study_content),this.intervalNum=Number(this.formData.stage_number),this.makeName=this.formData.make_name,e.next=12;break;case 11:this.makeName=this.name;case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),NumArr:function(e){return new p(e)},chnNumChar:d["default"].filter("chnNumChar"),getreeList:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["B"])();case 2:t=e.sent,a=t.data.list,this.initTreeData(a),this.BaseframeAdminData=Object(f["a"])(a),this.copyBaseInfo=Object(r["a"])(this.BaseframeAdminData);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),initTreeData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.map((function(t){"0"===t.parent_id?t.disabled=!0:t.disabled=!1,t.children&&e.initTreeData(t.children)}))},switchSecondStep:function(){if(0===this.active&&!this.disabled)return!1;this.active=1},switchFirstStep:function(){var e=this;if(this.disabled)return this.active=0,!1;var t="";t="编辑"===this.$route.query.haddleType?"是否返回第一步进行修改，返回后第二步已编辑数据会清除，请确定是否返回？":"是否返回第一步进行修改，返回后第二步数据会清除，请确定是否返回？",this.$confirm(t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",center:!0}).then(Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.active=0,e.showDialog=!1;case 2:case"end":return t.stop()}}),t)})))).catch((function(){}))},nextStep:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getreeList();case 2:this.$refs[t].validate((function(e){if(e){var t=/^\+?[1-9]\d*$/;if(a.planListId){var i=!0,n=!1,r=void 0;try{for(var s,o=a.formData.stage_study_number[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var d=s.value;if(""===d)return a.$message({message:"各阶段每天学习节数不能为空！",type:"warning"}),!1;if(!t.test(d))return a.$message({message:"输入阿拉伯数字，如1，2…",type:"warning"}),!1}}catch(N){n=!0,r=N}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}}if(a.formData.stage_study_number.length!==a.formData.stage_number)return a.$message({message:"各阶段每天学习节数不能为空！",type:"warning"}),!1;var c=!0,l=!1,u=void 0;try{for(var h,p=a.formData.stage_study_number[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var b=h.value;if(!t.test(b))return a.$message({message:"输入阿拉伯数字，如1，2…",type:"warning"}),!1}}catch(N){l=!0,u=N}finally{try{c||null==p.return||p.return()}finally{if(l)throw u}}a.active=1;var y=a.formData,v=y.stage_number,_=y.job_rotation_position;if(a.planListId){var g=a.formData.job_rotation_position,D={};a.frameAdminData.map((function(e){e.ptitle=e.ptitle.substring(1)})),a.frameAdminData.forEach((function(e,t){"轮岗"===e.title&&(D=e,a.frameAdminData.splice(t,1),a.frameAdminData.splice(g,0,D))})),a.treeKey++,a.frameAdminData=Object(f["a"])(a.frameAdminData);var A=a;return a.frameAdminData.forEach((function(e){e.children&&e.children.forEach((function(e){e.children&&e.children.forEach((function(e){A.changeNodeDisable(A.copyBaseInfo,e.id,!0)}))}))})),!1}a.frameAdminData=Object(f["a"])(m(v,_));var j=a;return a.frameAdminData.forEach((function(e){e.children&&e.children.forEach((function(e){e.children&&e.children.forEach((function(e){j.changeNodeDisable(j.copyBaseInfo,e.id,!0)}))}))})),!1}return!1}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),findSecondTreeByid:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=0;a<e.length;a++){var i=e[a].children;if(i){var n=i.findIndex((function(e){return e.id===t}));if(n>=0)return i[n].now_index=n,[i[n]]}}return[]},handleAdd:function(e,t,a){this.addIndex=a.id-1,this.isEdit=!1,"second"===a.type?this.BaseframeAdminData=this.findSecondTreeByid(this.copyBaseInfo,a.id)[0].children:this.BaseframeAdminData=this.copyBaseInfo,this.showDialog=!0,this.curActiveNodeKey=a},haddleEdit:function(e,t,a){this.isEdit=!0,"second"===a.type?this.BaseframeAdminData=this.copyBaseInfo:"third"===a.type&&(this.BaseframeAdminData=this.findSecondTreeByid(this.copyBaseInfo,a.parent_id)[0].children),this.curActiveNodeKey=a,this.showDialog=!0},remove:function(e,t,a){if("second"===a.type){for(var i=0;i<this.frameAdminData.length;i++)if(this.frameAdminData[i].children){var n=this.frameAdminData[i].children.findIndex((function(e){return e.id===a.id}));if(n>=0){this.frameAdminData[i].children.splice(n,1),this.frameAdminData=Object(u["c"])(this.frameAdminData);break}}}else if("third"===a.type){var r=this.findSecondTreeByid(this.frameAdminData,a.parent_id)[0],s=r.children.findIndex((function(e){return e.id===a.id}));s>=0&&r.children.splice(s,1)}this.changeNodeDisable(this.copyBaseInfo,a.id,!1),this.frameAdminData=Object(f["a"])(this.frameAdminData)},changeNodeDisable:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=0;i<e.length;i++){var n=e[i];n.id&&n.id===t&&(n.disabled=a,"second"===n.type&&n.children.forEach((function(e){e.disabled=a})),"third"===n.type&&this.resetCopyTreeSencendDisable()),n.children&&Array.isArray(n.children)&&this.changeNodeDisable(n.children,t,a)}},resetCopyTreeSencendDisable:function(){for(var e=0;e<this.copyBaseInfo.length;e++){var t=this.copyBaseInfo[e].children;t.forEach((function(e){if(e.children){var t=e.children.filter((function(e){return e.disabled}));e.children.length>0&&t.length===e.children.length?e.disabled=!0:e.disabled=!1}}))}},handleSelectTreeNodeClick:function(e){var t=this;if(e.disabled)return!1;if(this.isEdit){if("third"===this.curActiveNodeKey.type){var a=this.findSecondTreeByid(this.frameAdminData,this.curActiveNodeKey.parent_id)[0],i=a.children.findIndex((function(e){return e.id===t.curActiveNodeKey.id}));i>=0&&(a.children.splice(i,1,Object(u["c"])(e)),this.changeNodeDisable(this.copyBaseInfo,this.curActiveNodeKey.id,!1),this.curActiveNodeKey=e,this.changeNodeDisable(this.copyBaseInfo,e.id,!0))}else if("second"===this.curActiveNodeKey.type&&"second"===e.type)for(var n=0;n<this.frameAdminData.length;n++)if(this.frameAdminData[n].children){var r=this.frameAdminData[n].children.findIndex((function(e){return e.id===t.curActiveNodeKey.id}));if(r>=0){this.frameAdminData[n].children.splice(r,1,e),this.frameAdminData=Object(u["c"])(this.frameAdminData),this.changeNodeDisable(this.copyBaseInfo,this.curActiveNodeKey.id,!1),this.curActiveNodeKey=e,this.changeNodeDisable(this.copyBaseInfo,e.id,!0);break}}}else{if("third"===e.type)if("first"===this.curActiveNodeKey.type){var s=this.findSecondTreeByid(this.frameAdminData,e.parent_id)[0],o=Object(u["c"])(this.findSecondTreeByid(this.copyBaseInfo,e.parent_id))[0];s?(s.children.push(Object(u["c"])(e)),this.treeKey++):(o.children=[],o.children.push(e),this.$refs["step2-tree"].append(o,this.curActiveNodeKey))}else this.$refs["step2-tree"].append(Object(u["c"])(e),this.curActiveNodeKey);else{var d=this.findSecondTreeByid(this.frameAdminData,e.id)[0];if(d){var c=Object(u["c"])(e.children);this.$refs["step2-tree"].updateKeyChildren(d.id,c)}else this.$refs["step2-tree"].append(Object(u["c"])(e),this.curActiveNodeKey)}this.changeNodeDisable(this.copyBaseInfo,e.id,!0)}this.frameAdminData=Object(f["a"])(this.frameAdminData)},haddleCreatePlan:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.isConfirm=!0,this.showDialog=!1;case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),haddleConfirm:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,a,i,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.formData.stage_study_number.map((function(e){return Number(e)})),"编辑"!==this.haddleType){e.next=9;break}return a={name:this.formData.name,job_rotation_position:this.formData.job_rotation_position,job_rotation_day:this.formData.job_rotation_day,job_test_day:this.formData.job_test_day,stage_study_number:t,stage_study_content:this.frameAdminData,id:this.planListId},e.next=5,Object(l["bb"])(a);case 5:i=e.sent,2e4===i.code&&(i.data.result?this.$router.push({path:"/learning-admin/PlanAdmin"}):this.$message({message:i.data.message,type:"error"})),e.next=14;break;case 9:return n={name:this.formData.name,stage_number:this.formData.stage_number,job_rotation_position:this.formData.job_rotation_position,job_rotation_day:this.formData.job_rotation_day,job_test_day:this.formData.job_test_day,stage_study_number:t,stage_study_content:this.frameAdminData},e.next=12,Object(l["j"])(n);case 12:r=e.sent,2e4===r.code&&this.$router.push({path:"/learning-admin/PlanAdmin"});case 14:this.expandOnClickNode=!0;case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),haddleCancel:function(){this.isConfirm=!1},isRepeat:function(e){var t={};for(var a in e){if(t[e[a].id])return!0;t[e[a].id]=!0}return!1}}},y=b,v=(a("4002"),a("f1b2"),a("2877")),_=Object(v["a"])(y,i,n,!1,null,"8468220a",null);t["default"]=_.exports},f1b2:function(e,t,a){"use strict";var i=a("06d2"),n=a.n(i);n.a}}]);
//# sourceMappingURL=chunk-0215a714.927d02f4.js.map